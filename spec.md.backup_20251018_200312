# Campus Navigator Web Game - å®Œæ•´è¦æ ¼æ–‡ä»¶

## ç‰ˆæœ¬è³‡è¨Š
- **å°ˆæ¡ˆåç¨±**: Campus Navigator Web Game
- **ç‰ˆæœ¬**: 2.0 (Web Game Edition)
- **æ–‡ä»¶ç‰ˆæœ¬**: 2.1.0
- **æœ€å¾Œæ›´æ–°**: 2025-10-18
- **å°ˆæ¡ˆç‹€æ…‹**: é–‹ç™¼ä¸­ (Phase 1-2 å®Œæˆ)
- **å°ˆæ¡ˆé¡å‹**: ç­‰è·è¦–è§’ 2.5D Web äº’å‹•éŠæˆ²
- **é–‹ç™¼èªè¨€**: TypeScript + React
- **ç›®æ¨™å¹³å°**: ç¾ä»£ç€è¦½å™¨ï¼ˆChrome, Firefox, Safari, Edgeï¼‰
- **è¦–è¦ºé¢¨æ ¼**: Isometric (ç­‰è·è¦–è§’)
- **Git Commit**: cca0227 (åˆå§‹ç‰ˆæœ¬)

---

## ç›®éŒ„
1. [å°ˆæ¡ˆæ¦‚è¿°](#1-å°ˆæ¡ˆæ¦‚è¿°)
2. [æ¶æ§‹èˆ‡æŠ€è¡“é¸å‹](#2-æ¶æ§‹èˆ‡æŠ€è¡“é¸å‹)
3. [è³‡æ–™æ¨¡å‹](#3-è³‡æ–™æ¨¡å‹)
4. [éš¨æ©Ÿåœ°åœ–ç”Ÿæˆç³»çµ±](#4-éš¨æ©Ÿåœ°åœ–ç”Ÿæˆç³»çµ±)
5. [ç­‰è·è¦–è§’æ¸²æŸ“ç³»çµ±](#5-ç­‰è·è¦–è§’æ¸²æŸ“ç³»çµ±)
6. [éŠæˆ²æµç¨‹è¨­è¨ˆ](#6-éŠæˆ²æµç¨‹è¨­è¨ˆ)
7. [UI/UX è¨­è¨ˆ](#7-uiux-è¨­è¨ˆ)
8. [ç‹€æ…‹ç®¡ç†](#8-ç‹€æ…‹ç®¡ç†)
9. [æœ¬åœ°å„²å­˜è¨­è¨ˆ](#9-æœ¬åœ°å„²å­˜è¨­è¨ˆ)
10. [åºåˆ—åœ–](#10-åºåˆ—åœ–)
11. [é¡åˆ¥åœ–](#11-é¡åˆ¥åœ–)
12. [æµç¨‹åœ–](#12-æµç¨‹åœ–)
13. [ç‹€æ…‹åœ–](#13-ç‹€æ…‹åœ–)
14. [è™›æ“¬ç¢¼](#14-è™›æ“¬ç¢¼)
15. [é–‹ç™¼è·¯ç·šåœ–](#15-é–‹ç™¼è·¯ç·šåœ–)
16. [æ¸¬è©¦ç­–ç•¥](#16-æ¸¬è©¦ç­–ç•¥)

---

## 1. å°ˆæ¡ˆæ¦‚è¿°

### 1.1 å°ˆæ¡ˆç›®æ¨™
Campus Navigator æ˜¯ä¸€æ¬¾**ç­‰è·è¦–è§’ 2.5D Web éŠæˆ²**ï¼Œç©å®¶æ‰®æ¼”å­¸ç”Ÿåœ¨éš¨æ©Ÿç”Ÿæˆçš„è™›æ“¬æ ¡åœ’ä¸­æ¢ç´¢ã€è¨ªå•ä¸åŒåœ°é»ã€åƒåŠ æ´»å‹•ã€é è¨‚å ´åœ°ï¼Œä¸¦å®Œæˆå„ç¨®ä»»å‹™ã€‚éŠæˆ²æ¡ç”¨ React + Vite æŠ€è¡“æ£§ï¼Œæä¾›æµæš¢çš„éŠæˆ²é«”é©—å’Œç²¾ç¾çš„ç­‰è·è¦–è§’è¦–è¦ºå‘ˆç¾ã€‚

### 1.2 éŠæˆ²ç‰¹è‰²
- ğŸ² **éš¨æ©Ÿåœ°åœ–ç”Ÿæˆ**: æ¯æ¬¡éŠæˆ²éƒ½æ˜¯å…¨æ–°çš„æ ¡åœ’å¸ƒå±€ï¼Œä¿è­‰å¯ç©æ€§
- ğŸ¨ **ç­‰è·è¦–è§’å‘ˆç¾**: ç²¾ç¾çš„ 2.5D éŠæˆ²ç•«é¢ï¼Œæ¨¡æ“¬åŸå¸‚ã€ç´€å¿µç¢‘è°·é¢¨æ ¼
- ğŸ® **æµæš¢äº’å‹•**: æ”¯æ´éµç›¤ï¼ˆWASD/æ–¹å‘éµï¼‰å’Œæ»‘é¼ é»æ“Šé›™é‡æ“ä½œ
- ğŸ’¾ **é€²åº¦å„²å­˜**: LocalStorage æœ¬åœ°å„²å­˜éŠæˆ²é€²åº¦ï¼Œæ”¯æ´å¤šå­˜æª”
- ğŸ† **æˆå°±ç³»çµ±**: è§£é–å„ç¨®æˆå°±å’Œçå‹µ
- ğŸ“Š **æ•¸æ“šçµ±è¨ˆ**: è©³ç´°çš„éŠæˆ²æ•¸æ“šè¿½è¹¤å’Œå¯è¦–åŒ–
- ğŸµ **éŸ³æ•ˆç³»çµ±**: èƒŒæ™¯éŸ³æ¨‚å’Œäº’å‹•éŸ³æ•ˆå¢å¼·æ²‰æµ¸æ„Ÿ

### 1.3 æ ¸å¿ƒç©æ³•
1. **æ ¡åœ’æ¢ç´¢**: åœ¨éš¨æ©Ÿç”Ÿæˆçš„ç­‰è·åœ°åœ–ä¸Šè‡ªç”±ç§»å‹•
2. **åœ°é»äº’å‹•**: è¨ªå• 5 ç¨®ä¸åŒé¡å‹çš„æ ¡åœ’å»ºç¯‰
   - ğŸ›ï¸ Libraryï¼ˆåœ–æ›¸é¤¨ï¼‰
   - ğŸ½ï¸ Cafeteriaï¼ˆé¤å»³ï¼‰
   - ğŸƒ Sports Centerï¼ˆé‹å‹•ä¸­å¿ƒï¼‰
   - ğŸ« Lecture Hallï¼ˆè¬›å ‚ï¼‰
   - ğŸ­ Event Hallï¼ˆæ´»å‹•å»³ï¼‰
3. **æ´»å‹•åƒèˆ‡**: åƒåŠ  3 ç¨®æ´»å‹•é¡å‹ç²å¾—åˆ†æ•¸
   - ğŸ“š Lectureï¼ˆè¬›åº§ï¼‰
   - ğŸ’¬ Seminarï¼ˆç ”è¨æœƒï¼‰
   - ğŸ“ Examï¼ˆè€ƒè©¦ï¼‰
4. **å ´åœ°é è¨‚**: é è¨‚é‹å‹•ä¸­å¿ƒå’Œæ´»å‹•å»³è§£é–ç‰¹æ®Šçå‹µ
5. **ä»»å‹™ç³»çµ±**: å®Œæˆæ¯æ—¥ä»»å‹™å’Œæˆå°±è³ºå–é¡å¤–åˆ†æ•¸
6. **æ’è¡Œæ¦œ**: èˆ‡æ­·å²æœ€ä½³æˆç¸¾ç«¶çˆ­

### 1.4 éŠæˆ²ç›®æ¨™
- **ä¸»è¦ç›®æ¨™**: è¨ªå•æ‰€æœ‰åœ°é»ä¸¦åƒåŠ æ‰€æœ‰æ´»å‹•
- **æ¬¡è¦ç›®æ¨™**:
  - æœ€å°ç§»å‹•æ¬¡æ•¸å®Œæˆ
  - é¿å…ç¢°æ’ï¼ˆé›¶ç¢°æ’æŒ‘æˆ°ï¼‰
  - è§£é–æ‰€æœ‰æˆå°±
  - æ‰“ç ´æœ€é«˜åˆ†è¨˜éŒ„

### 1.5 å°ˆæ¡ˆç•¶å‰ç‹€æ…‹ (2025-10-18)

#### âœ… å·²å®ŒæˆåŠŸèƒ½
- **åŸºç¤æ¶æ§‹** (100%)
  - React + Vite + TypeScript é–‹ç™¼ç’°å¢ƒ
  - Zustand ç‹€æ…‹ç®¡ç†ç³»çµ±
  - Tailwind CSS æ¨£å¼æ¡†æ¶
  - ESLint + Prettier ç¨‹å¼ç¢¼è¦ç¯„
  - Git ç‰ˆæœ¬æ§åˆ¶ï¼ˆåˆå§‹ commit: cca0227ï¼‰

- **åœ°åœ–ç”Ÿæˆç³»çµ±** (100%)
  - éš¨æ©Ÿåœ°åœ–ç”Ÿæˆæ¼”ç®—æ³•
  - 18Ã—18 ç¶²æ ¼ç³»çµ±
  - 13 å€‹åœ°é»ï¼ˆç¬¦åˆè¦æ ¼ï¼‰
  - 27 å€‹æ´»å‹•è‡ªå‹•ç”Ÿæˆ
  - éšœç¤™ç‰©éš¨æ©Ÿåˆ†å¸ƒ
  - é€£é€šæ€§é©—è­‰

- **è³‡æ–™æ¨¡å‹** (100%)
  - å®Œæ•´ TypeScript ä»‹é¢å®šç¾©
  - CampusMap, Place, Event, Player ç­‰æ¨¡å‹
  - é¡å‹å®‰å…¨çš„è³‡æ–™çµæ§‹

- **åŸºç¤ UI** (50%)
  - ä¸»é¸å–®é¡¯ç¤º
  - éŠæˆ² HUDï¼ˆåˆ†æ•¸ã€ä½ç½®ã€çµ±è¨ˆï¼‰
  - æ–‡å­—æ¨¡å¼åœ°åœ–é è¦½ï¼ˆè‡¨æ™‚æ–¹æ¡ˆï¼‰
  - åœ°é»åˆ—è¡¨é¡¯ç¤º

#### ğŸš§ é–‹ç™¼ä¸­åŠŸèƒ½
- **ç©å®¶ç§»å‹•ç³»çµ±** (0%) - ğŸ¯ é«˜å„ªå…ˆç´š
- **åœ°é»äº’å‹•ç³»çµ±** (0%) - ğŸ¯ é«˜å„ªå…ˆç´š
- **Canvas æ¸²æŸ“ç³»çµ±** (10%) - ğŸ”¥ æœ€é«˜å„ªå…ˆç´š
  - ç­‰è·åº§æ¨™è½‰æ›å·¥å…·å·²å®Œæˆ
  - Canvas æ¸²æŸ“å™¨å¾…å¯¦ä½œ

#### ğŸ“Š æ¸¬è©¦ç‹€æ…‹
- **æ¸¬è©¦è¦†è“‹ç‡**: ç´„ 30%
- **æ¸¬è©¦æ¡ˆä¾‹**: 6/30 é€šé
- **æ¸¬è©¦å ±å‘Š**: `test-report.md`
- **æ¸¬è©¦åŠ‡æœ¬**: `script.md`
- **å·²æ¸¬è©¦é …ç›®**:
  - âœ… ä¸»é¸å–®åŠŸèƒ½ (2/2)
  - âœ… æ–°éŠæˆ²æµç¨‹ (3/3)
  - âœ… åœ°åœ–ç”Ÿæˆé©—è­‰ (1/1)
- **å¾…æ¸¬è©¦é …ç›®**:
  - â¸ï¸ ç©å®¶ç§»å‹•ç³»çµ±
  - â¸ï¸ åœ°é»äº’å‹•ç³»çµ±
  - â¸ï¸ Canvas æ¸²æŸ“
  - â¸ï¸ å­˜æª”ç³»çµ±

#### ğŸ¯ ä¸‹ä¸€æ­¥é–‹ç™¼é‡é»
**éšæ®µ 2-3 å„ªå…ˆé …ç›®**:
1. **å¯¦ä½œ Canvas ç­‰è·è¦–è§’æ¸²æŸ“** (æœ€é«˜å„ªå…ˆç´š)
   - å»ºç«‹ IsometricRenderer é¡åˆ¥
   - å¯¦ä½œåœ°åœ–ç£šå¡Šæ¸²æŸ“
   - å¯¦ä½œç©å®¶ç²¾éˆé¡¯ç¤º
   - æ›¿æ›æ–‡å­—æ¨¡å¼

2. **å¯¦ä½œç©å®¶ç§»å‹•ç³»çµ±** (é«˜å„ªå…ˆç´š)
   - éµç›¤è¼¸å…¥è™•ç†ï¼ˆWASD + æ–¹å‘éµï¼‰
   - ç¢°æ’åµæ¸¬é‚è¼¯
   - ç§»å‹•å‹•ç•«
   - ç›¸æ©Ÿè·Ÿéš¨

3. **å¯¦ä½œåœ°é»äº’å‹•ç³»çµ±** (é«˜å„ªå…ˆç´š)
   - åœ°é»è¨ªå•åµæ¸¬
   - å°è©±æ¡†ç³»çµ±
   - æ´»å‹•é¸æ“‡ä»‹é¢
   - å¾—åˆ†è¨ˆç®—

**è©³ç´°è¦åŠƒè«‹åƒè€ƒ**: [ç¬¬ 15 ç« ï¼šé–‹ç™¼è·¯ç·šåœ–](#15-é–‹ç™¼è·¯ç·šåœ–)

---

## 2. æ¶æ§‹èˆ‡æŠ€è¡“é¸å‹

### 2.1 ç³»çµ±æ¶æ§‹

```mermaid
graph TD
    A[Presentation Layer<br/>React Components<br/>- GameCanvas ç­‰è·è¦–è§’ç•«å¸ƒ<br/>- UI Controls æ§åˆ¶ä»‹é¢<br/>- HUD è³‡è¨Šé¡¯ç¤º]
    B[State Management<br/>Zustand Store<br/>- Game State éŠæˆ²ç‹€æ…‹<br/>- Player State ç©å®¶ç‹€æ…‹<br/>- Map State åœ°åœ–ç‹€æ…‹]
    C[Game Logic Layer<br/>Core Game Engine<br/>- Map Generator åœ°åœ–ç”Ÿæˆå™¨<br/>- Collision Detection ç¢°æ’åµæ¸¬<br/>- Event System äº‹ä»¶ç³»çµ±]
    D[Rendering Layer<br/>Isometric Renderer<br/>- Tile Rendering ç£šå¡Šæ¸²æŸ“<br/>- Sprite Animation ç²¾éˆå‹•ç•«<br/>- Effect System ç‰¹æ•ˆç³»çµ±]
    E[Data Layer<br/>LocalStorage<br/>- Game Save éŠæˆ²å­˜æª”<br/>- Settings è¨­å®š<br/>- High Scores æœ€é«˜åˆ†]

    A --> B
    B --> C
    C --> D
    A --> D
    B --> E
```

### 2.2 æŠ€è¡“é¸å‹

#### æ ¸å¿ƒæŠ€è¡“æ£§
| æŠ€è¡“é …ç›® | é¸ç”¨æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|---------|---------|------|------|
| å‰ç«¯æ¡†æ¶ | React | 18+ | UI çµ„ä»¶åŒ–é–‹ç™¼ |
| å»ºæ§‹å·¥å…· | Vite | 5+ | å¿«é€Ÿé–‹ç™¼é«”é©—ã€HMR |
| ç¨‹å¼èªè¨€ | TypeScript | 5+ | é¡å‹å®‰å…¨ã€IDE æ”¯æ´ |
| ç‹€æ…‹ç®¡ç† | Zustand | 4+ | è¼•é‡ç´šç‹€æ…‹ç®¡ç† |
| æ¨£å¼æ–¹æ¡ˆ | Tailwind CSS | 3+ | å¿«é€Ÿæ¨£å¼é–‹ç™¼ |
| æ¸²æŸ“å¼•æ“ | HTML5 Canvas | - | 2D éŠæˆ²æ¸²æŸ“ |
| å¥—ä»¶ç®¡ç† | pnpm | 8+ | å¿«é€Ÿã€ç¯€çœç©ºé–“ |

#### é–‹ç™¼å·¥å…·éˆ
- **ç¨‹å¼ç¢¼è¦ç¯„**: ESLint + Prettier
- **ç‰ˆæœ¬æ§åˆ¶**: Git + GitHub
- **éƒ¨ç½²å¹³å°**: Vercel / Netlify / GitHub Pages
- **æ¸¬è©¦æ¡†æ¶**: Vitest + React Testing Library
- **E2E æ¸¬è©¦**: Playwright

#### è¨­è¨ˆæ¨¡å¼
1. **Component Pattern**: React çµ„ä»¶åŒ–æ¶æ§‹
2. **Observer Pattern**: Zustand ç‹€æ…‹è¨‚é–±
3. **Factory Pattern**: åœ°é»å’Œäº‹ä»¶ç‰©ä»¶ç”Ÿæˆ
4. **Strategy Pattern**: ä¸åŒåœ°é»é¡å‹çš„äº’å‹•ç­–ç•¥
5. **Singleton Pattern**: éŠæˆ²å¼•æ“å¯¦ä¾‹
6. **Command Pattern**: ç©å®¶ç§»å‹•æŒ‡ä»¤

### 2.3 å°ˆæ¡ˆçµæ§‹

```
campus-navigator/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ sprites/           # éŠæˆ²ç²¾éˆåœ–
â”‚   â”‚   â”‚   â”œâ”€â”€ player/        # ç©å®¶ç²¾éˆï¼ˆ8æ–¹å‘ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ places/        # å»ºç¯‰ç‰©ç²¾éˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ tiles/         # åœ°åœ–ç£šå¡Š
â”‚   â”‚   â”‚   â””â”€â”€ effects/       # ç‰¹æ•ˆå‹•ç•«
â”‚   â”‚   â”œâ”€â”€ sounds/            # éŸ³æ•ˆæª”æ¡ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ bgm/           # èƒŒæ™¯éŸ³æ¨‚
â”‚   â”‚   â”‚   â”œâ”€â”€ sfx/           # éŸ³æ•ˆ
â”‚   â”‚   â”‚   â””â”€â”€ ambient/       # ç’°å¢ƒéŸ³
â”‚   â”‚   â””â”€â”€ fonts/             # éŠæˆ²å­—é«”
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/            # React çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ Game/
â”‚   â”‚   â”‚   â”œâ”€â”€ GameCanvas.tsx           # ä¸»éŠæˆ²ç•«å¸ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ IsometricGrid.tsx        # ç­‰è·ç¶²æ ¼æ¸²æŸ“
â”‚   â”‚   â”‚   â”œâ”€â”€ Player.tsx               # ç©å®¶ç²¾éˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ Place.tsx                # åœ°é»ç²¾éˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ TileMap.tsx              # åœ°åœ–ç£šå¡Šå±¤
â”‚   â”‚   â”‚   â””â”€â”€ EffectLayer.tsx          # ç‰¹æ•ˆå±¤
â”‚   â”‚   â”œâ”€â”€ UI/
â”‚   â”‚   â”‚   â”œâ”€â”€ HUD.tsx                  # æŠ¬é ­é¡¯ç¤ºå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Menu.tsx                 # ä¸»é¸å–®
â”‚   â”‚   â”‚   â”œâ”€â”€ Dialog.tsx               # å°è©±æ¡†ç³»çµ±
â”‚   â”‚   â”‚   â”œâ”€â”€ StatsPanel.tsx           # çµ±è¨ˆé¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ MiniMap.tsx              # å°åœ°åœ–
â”‚   â”‚   â”‚   â””â”€â”€ Inventory.tsx            # ç‰©å“æ¬„
â”‚   â”‚   â””â”€â”€ Screens/
â”‚   â”‚       â”œâ”€â”€ MainMenuScreen.tsx       # ä¸»é¸å–®ç•«é¢
â”‚   â”‚       â”œâ”€â”€ GameScreen.tsx           # éŠæˆ²ç•«é¢
â”‚   â”‚       â”œâ”€â”€ PauseScreen.tsx          # æš«åœç•«é¢
â”‚   â”‚       â””â”€â”€ EndGameScreen.tsx        # çµæŸç•«é¢
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒéŠæˆ²é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ MapGenerator.ts              # åœ°åœ–ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ CollisionSystem.ts           # ç¢°æ’åµæ¸¬ç³»çµ±
â”‚   â”‚   â”œâ”€â”€ EventManager.ts              # äº‹ä»¶ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ PathFinding.ts               # A* å°‹è·¯æ¼”ç®—æ³•
â”‚   â”‚   â”œâ”€â”€ GameLoop.ts                  # éŠæˆ²ä¸»å¾ªç’°
â”‚   â”‚   â””â”€â”€ IsometricEngine.ts           # ç­‰è·è¦–è§’å¼•æ“
â”‚   â”œâ”€â”€ models/                # è³‡æ–™æ¨¡å‹ï¼ˆTypeScript interfacesï¼‰
â”‚   â”‚   â”œâ”€â”€ CampusMap.ts
â”‚   â”‚   â”œâ”€â”€ Player.ts
â”‚   â”‚   â”œâ”€â”€ Place.ts
â”‚   â”‚   â”œâ”€â”€ Event.ts
â”‚   â”‚   â”œâ”€â”€ Score.ts
â”‚   â”‚   â””â”€â”€ Achievement.ts
â”‚   â”œâ”€â”€ stores/                # Zustand ç‹€æ…‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ gameStore.ts                 # éŠæˆ²ç‹€æ…‹
â”‚   â”‚   â”œâ”€â”€ playerStore.ts               # ç©å®¶ç‹€æ…‹
â”‚   â”‚   â”œâ”€â”€ mapStore.ts                  # åœ°åœ–ç‹€æ…‹
â”‚   â”‚   â””â”€â”€ uiStore.ts                   # UI ç‹€æ…‹
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•¸
â”‚   â”‚   â”œâ”€â”€ isometric.ts                 # ç­‰è·åº§æ¨™è½‰æ›
â”‚   â”‚   â”œâ”€â”€ random.ts                    # éš¨æ©Ÿæ•¸å·¥å…·
â”‚   â”‚   â”œâ”€â”€ storage.ts                   # LocalStorage å°è£
â”‚   â”‚   â”œâ”€â”€ soundManager.ts              # éŸ³æ•ˆç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ validator.ts                 # è³‡æ–™é©—è­‰
â”‚   â”œâ”€â”€ constants/             # å¸¸æ•¸å®šç¾©
â”‚   â”‚   â”œâ”€â”€ gameConfig.ts                # éŠæˆ²é…ç½®
â”‚   â”‚   â”œâ”€â”€ placeTypes.ts                # åœ°é»é¡å‹
â”‚   â”‚   â”œâ”€â”€ eventTypes.ts                # äº‹ä»¶é¡å‹
â”‚   â”‚   â””â”€â”€ achievements.ts              # æˆå°±å®šç¾©
â”‚   â”œâ”€â”€ hooks/                 # Custom React Hooks
â”‚   â”‚   â”œâ”€â”€ useGameLoop.ts               # éŠæˆ²å¾ªç’° Hook
â”‚   â”‚   â”œâ”€â”€ useKeyboard.ts               # éµç›¤è¼¸å…¥ Hook
â”‚   â”‚   â”œâ”€â”€ useLocalStorage.ts           # LocalStorage Hook
â”‚   â”‚   â””â”€â”€ useSound.ts                  # éŸ³æ•ˆ Hook
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ main.tsx
â”‚   â””â”€â”€ vite-env.d.ts
â”œâ”€â”€ tests/                     # æ¸¬è©¦æª”æ¡ˆ
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â””â”€â”€ README.md
```

---

## 3. è³‡æ–™æ¨¡å‹

### 3.1 æ ¸å¿ƒ TypeScript Interfaces

#### 3.1.1 Positionï¼ˆä½ç½®ï¼‰

```typescript
/**
 * è¡¨ç¤º 2D ç¶²æ ¼ä½ç½®
 */
export interface Position {
  row: number;    // è¡Œç´¢å¼•
  col: number;    // åˆ—ç´¢å¼•
}

/**
 * ç­‰è·è¦–è§’åº§æ¨™ï¼ˆè¢å¹•åƒç´ åº§æ¨™ï¼‰
 */
export interface IsometricPosition {
  x: number;      // è¢å¹• X åº§æ¨™
  y: number;      // è¢å¹• Y åº§æ¨™
}
```

#### 3.1.2 CampusMapï¼ˆæ ¡åœ’åœ°åœ–ï¼‰

```typescript
/**
 * åœ°åœ–ä½ç½®é¡å‹
 */
export enum MapPositionType {
  BOUNDARY = 'BOUNDARY',       // é‚Šç•Œç‰†
  OPEN = 'OPEN',               // é–‹æ”¾è·¯å¾‘
  RESTRICTED = 'RESTRICTED',   // é™åˆ¶å€åŸŸï¼ˆéšœç¤™ç‰©ï¼‰
  PLACE = 'PLACE',             // åœ°é»
  START = 'START'              // èµ·å§‹ä½ç½®
}

/**
 * æ ¡åœ’åœ°åœ–
 */
export interface CampusMap {
  name: string;                         // åœ°åœ–åç¨±
  rows: number;                         // è¡Œæ•¸
  columns: number;                      // åˆ—æ•¸
  grid: MapPositionType[][];            // åœ°åœ–ç¶²æ ¼
  places: (Place | null)[][];           // åœ°é»ç¶²æ ¼
  startPosition: Position;              // èµ·å§‹ä½ç½®
  generatedAt: number;                  // ç”Ÿæˆæ™‚é–“æˆ³
  seed?: number;                        // éš¨æ©Ÿç¨®å­ï¼ˆç”¨æ–¼é‡ç¾åœ°åœ–ï¼‰
}
```

#### 3.1.3 Placeï¼ˆåœ°é»ï¼‰

```typescript
/**
 * åœ°é»é¡å‹
 */
export enum PlaceType {
  LIBRARY = 'LIBRARY',                 // åœ–æ›¸é¤¨
  CAFETERIA = 'CAFETERIA',             // é¤å»³
  SPORTS_CENTER = 'SPORTS_CENTER',     // é‹å‹•ä¸­å¿ƒ
  LECTURE_HALL = 'LECTURE_HALL',       // è¬›å ‚
  EVENT_HALL = 'EVENT_HALL'            // æ´»å‹•å»³
}

/**
 * åœ°é»åŸºç¤ä»‹é¢
 */
export interface Place {
  id: string;                           // å”¯ä¸€è­˜åˆ¥ç¢¼
  name: string;                         // åœ°é»åç¨±
  type: PlaceType;                      // åœ°é»é¡å‹
  position: Position;                   // ä½ç½®
  score: number;                        // è¨ªå•å¾—åˆ†
  visited: boolean;                     // æ˜¯å¦å·²è¨ªå•
  restricted: boolean;                  // æ˜¯å¦å—é™ï¼ˆæœªå¯¦è£ï¼‰
  bookable: boolean;                    // æ˜¯å¦å¯é è¨‚
  booked: boolean;                      // æ˜¯å¦å·²é è¨‚
  events: Event[];                      // æ´»å‹•åˆ—è¡¨
  description: string;                  // æè¿°
  sprite: string;                       // ç²¾éˆåœ–è·¯å¾‘
}

/**
 * åœ–æ›¸é¤¨
 */
export interface Library extends Place {
  type: PlaceType.LIBRARY;
  studyRooms: number;                   // è‡ªç¿’å®¤æ•¸é‡
  openHours: string;                    // é–‹æ”¾æ™‚é–“
}

/**
 * é¤å»³
 */
export interface Cafeteria extends Place {
  type: PlaceType.CAFETERIA;
  menu: MenuItem[];                     // èœå–®é …ç›®
}

export interface MenuItem {
  name: string;                         // é¤é»åç¨±
  price: number;                        // åƒ¹æ ¼ï¼ˆè² åˆ†ï¼‰
}

/**
 * é‹å‹•ä¸­å¿ƒ
 */
export interface SportsCenter extends Place {
  type: PlaceType.SPORTS_CENTER;
  bookable: true;
  facilities: string[];                 // è¨­æ–½æ¸…å–®
}

/**
 * è¬›å ‚
 */
export interface LectureHall extends Place {
  type: PlaceType.LECTURE_HALL;
  capacity: number;                     // å®¹ç´äººæ•¸
  building: string;                     // å»ºç¯‰åç¨±
}

/**
 * æ´»å‹•å»³
 */
export interface EventHall extends Place {
  type: PlaceType.EVENT_HALL;
  bookable: true;
  stage: boolean;                       // æ˜¯å¦æœ‰èˆå°
}
```

#### 3.1.4 Eventï¼ˆæ´»å‹•ï¼‰

```typescript
/**
 * æ´»å‹•é¡å‹
 */
export enum EventType {
  LECTURE = 'LECTURE',                 // è¬›åº§
  SEMINAR = 'SEMINAR',                 // ç ”è¨æœƒ
  EXAM = 'EXAM'                        // è€ƒè©¦
}

/**
 * æ´»å‹•åŸºç¤ä»‹é¢
 */
export interface Event {
  id: number;                           // æ´»å‹• ID
  name: string;                         // æ´»å‹•åç¨±
  type: EventType;                      // æ´»å‹•é¡å‹
  date: string;                         // æ—¥æœŸ (YYYY-MM-DD)
  startTime: string;                    // é–‹å§‹æ™‚é–“ (HH:mm)
  endTime: string;                      // çµæŸæ™‚é–“ (HH:mm)
  score: number;                        // æ´»å‹•å¾—åˆ†
  attended: boolean;                    // æ˜¯å¦å·²åƒåŠ 
  placeId: string;                      // æ‰€å±¬åœ°é» ID
}

/**
 * è¬›åº§
 */
export interface Lecture extends Event {
  type: EventType.LECTURE;
  courseCode: string;                   // èª²ç¨‹ä»£ç¢¼
  lecturer: string;                     // è¬›å¸«
}

/**
 * ç ”è¨æœƒ
 */
export interface Seminar extends Event {
  type: EventType.SEMINAR;
  speakers: string[];                   // è¬›è€…åˆ—è¡¨
  topic: string;                        // ä¸»é¡Œ
}

/**
 * è€ƒè©¦
 */
export interface Exam extends Event {
  type: EventType.EXAM;
  courseCode: string;                   // èª²ç¨‹ä»£ç¢¼
  duration: number;                     // æ™‚é•·ï¼ˆåˆ†é˜ï¼‰
}
```

#### 3.1.5 Playerï¼ˆç©å®¶ï¼‰

```typescript
/**
 * ç§»å‹•æ–¹å‘
 */
export enum Direction {
  UP = 'UP',
  DOWN = 'DOWN',
  LEFT = 'LEFT',
  RIGHT = 'RIGHT',
  UP_LEFT = 'UP_LEFT',
  UP_RIGHT = 'UP_RIGHT',
  DOWN_LEFT = 'DOWN_LEFT',
  DOWN_RIGHT = 'DOWN_RIGHT'
}

/**
 * ç©å®¶ç‹€æ…‹
 */
export interface Player {
  currentPosition: Position;            // ç•¶å‰ä½ç½®
  previousPosition: Position | null;    // å‰ä¸€ä½ç½®
  facing: Direction;                    // é¢å‘æ–¹å‘
  totalMoves: number;                   // ç¸½ç§»å‹•æ¬¡æ•¸
  totalHits: number;                    // ç¸½ç¢°æ’æ¬¡æ•¸
  totalScore: number;                   // ç¸½å¾—åˆ†
  scoreHistory: Score[];                // å¾—åˆ†æ­·å²
  achievements: string[];               // å·²è§£é–æˆå°±
  inventory: string[];                  // ç‰©å“æ¬„
  sessionId: string;                    // æœƒè©± ID
  isMoving: boolean;                    // æ˜¯å¦æ­£åœ¨ç§»å‹•
  sprite: string;                       // ç©å®¶ç²¾éˆåœ–
}
```

#### 3.1.6 Scoreï¼ˆå¾—åˆ†è¨˜éŒ„ï¼‰

```typescript
/**
 * å¾—åˆ†è¨˜éŒ„
 */
export interface Score {
  id: string;                           // è¨˜éŒ„ ID
  sessionId: string;                    // æœƒè©± ID
  mapName: string;                      // åœ°åœ–åç¨±
  placeName: string;                    // åœ°é»åç¨±
  placeType: PlaceType;                 // åœ°é»é¡å‹
  eventName?: string;                   // æ´»å‹•åç¨±ï¼ˆå¯é¸ï¼‰
  eventType?: EventType;                // æ´»å‹•é¡å‹ï¼ˆå¯é¸ï¼‰
  date?: string;                        // æ—¥æœŸï¼ˆå¯é¸ï¼‰
  timeRange?: string;                   // æ™‚é–“ç¯„åœï¼ˆå¯é¸ï¼‰
  moves: number;                        // ç§»å‹•æ¬¡æ•¸
  hits: number;                         // ç¢°æ’æ¬¡æ•¸
  score: number;                        // å¾—åˆ†
  timestamp: number;                    // æ™‚é–“æˆ³
}
```

#### 3.1.7 GameStateï¼ˆéŠæˆ²ç‹€æ…‹ï¼‰

```typescript
/**
 * éŠæˆ²ç‹€æ…‹æšèˆ‰
 */
export enum GameStatus {
  MENU = 'MENU',                        // ä¸»é¸å–®
  PLAYING = 'PLAYING',                  // éŠç©ä¸­
  PAUSED = 'PAUSED',                    // æš«åœ
  COMPLETED = 'COMPLETED',              // å®Œæˆ
  GAME_OVER = 'GAME_OVER'               // éŠæˆ²çµæŸ
}

/**
 * éŠæˆ²ç‹€æ…‹
 */
export interface GameState {
  status: GameStatus;                   // ç•¶å‰ç‹€æ…‹
  map: CampusMap;                       // ç•¶å‰åœ°åœ–
  player: Player;                       // ç©å®¶
  elapsedTime: number;                  // ç¶“éæ™‚é–“ï¼ˆç§’ï¼‰
  isPaused: boolean;                    // æ˜¯å¦æš«åœ
  showDialog: boolean;                  // æ˜¯å¦é¡¯ç¤ºå°è©±æ¡†
  currentDialog?: DialogData;           // ç•¶å‰å°è©±è³‡æ–™
  settings: GameSettings;               // éŠæˆ²è¨­å®š
}

/**
 * éŠæˆ²è¨­å®š
 */
export interface GameSettings {
  soundEnabled: boolean;                // éŸ³æ•ˆé–‹é—œ
  musicEnabled: boolean;                // éŸ³æ¨‚é–‹é—œ
  volume: number;                       // éŸ³é‡ (0-1)
  showMiniMap: boolean;                 // é¡¯ç¤ºå°åœ°åœ–
  showGrid: boolean;                    // é¡¯ç¤ºç¶²æ ¼
}

/**
 * å°è©±è³‡æ–™
 */
export interface DialogData {
  type: 'place' | 'event' | 'achievement' | 'confirm';
  title: string;
  content: string;
  options?: DialogOption[];
}

export interface DialogOption {
  label: string;
  action: () => void;
}
```

#### 3.1.8 Achievementï¼ˆæˆå°±ï¼‰

```typescript
/**
 * æˆå°±
 */
export interface Achievement {
  id: string;                           // æˆå°± ID
  name: string;                         // æˆå°±åç¨±
  description: string;                  // æè¿°
  icon: string;                         // åœ–ç¤º
  unlocked: boolean;                    // æ˜¯å¦å·²è§£é–
  unlockedAt?: number;                  // è§£é–æ™‚é–“
  progress: number;                     // é€²åº¦ (0-100)
  requirement: string;                  // æ¢ä»¶èªªæ˜
}
```

---

## 4. éš¨æ©Ÿåœ°åœ–ç”Ÿæˆç³»çµ±

### 4.1 ç”Ÿæˆé…ç½®

```typescript
/**
 * åœ°åœ–ç”Ÿæˆé…ç½®
 */
export interface MapGenerationConfig {
  rows: number;                         // åœ°åœ–è¡Œæ•¸ (15-20)
  columns: number;                      // åœ°åœ–åˆ—æ•¸ (15-20)
  placeCount: {
    [PlaceType.LIBRARY]: [number, number];           // [min, max] = [2, 3]
    [PlaceType.CAFETERIA]: [number, number];         // [min, max] = [2, 4]
    [PlaceType.SPORTS_CENTER]: [number, number];     // [min, max] = [1, 2]
    [PlaceType.LECTURE_HALL]: [number, number];      // [min, max] = [3, 5]
    [PlaceType.EVENT_HALL]: [number, number];        // [min, max] = [1, 2]
  };
  obstacleRatio: number;                // éšœç¤™ç‰©æ¯”ä¾‹ (0.15 = 15%)
  minDistance: number;                  // åœ°é»æœ€å°é–“è· (3æ ¼)
  eventPerPlace: [number, number];      // æ¯å€‹åœ°é»çš„æ´»å‹•æ•¸ [min, max]
  seed?: number;                        // éš¨æ©Ÿç¨®å­ï¼ˆå¯é¸ï¼‰
}
```

### 4.2 ç”Ÿæˆæ¼”ç®—æ³•

#### æ­¥é©Ÿ 1: åˆå§‹åŒ–ç¶²æ ¼

```typescript
/**
 * åˆå§‹åŒ–ç©ºç™½åœ°åœ–ä¸¦å»ºç«‹é‚Šç•Œ
 */
function initializeGrid(rows: number, cols: number): MapPositionType[][] {
  const grid: MapPositionType[][] = [];

  for (let r = 0; r < rows; r++) {
    grid[r] = [];
    for (let c = 0; c < cols; c++) {
      // é‚Šç•Œè¨­ç‚º BOUNDARYï¼Œå…¶é¤˜è¨­ç‚º OPEN
      if (r === 0 || r === rows - 1 || c === 0 || c === cols - 1) {
        grid[r][c] = MapPositionType.BOUNDARY;
      } else {
        grid[r][c] = MapPositionType.OPEN;
      }
    }
  }

  return grid;
}
```

#### æ­¥é©Ÿ 2: éš¨æ©Ÿæ”¾ç½®åœ°é»

```typescript
/**
 * éš¨æ©Ÿæ”¾ç½®åœ°é»ï¼Œç¢ºä¿ä¸é‡ç–Šä¸”ç¬¦åˆæœ€å°é–“è·
 */
function placePlaces(
  grid: MapPositionType[][],
  config: MapGenerationConfig
): (Place | null)[][] {
  const places: (Place | null)[][] = Array(config.rows)
    .fill(null)
    .map(() => Array(config.columns).fill(null));

  const occupiedPositions: Position[] = [];

  // éæ­·æ‰€æœ‰åœ°é»é¡å‹
  Object.entries(config.placeCount).forEach(([type, [min, max]]) => {
    const count = randomInt(min, max + 1); // éš¨æ©Ÿæ•¸é‡

    for (let i = 0; i < count; i++) {
      let position: Position;
      let attempts = 0;
      const maxAttempts = 100;

      // å˜—è©¦æ‰¾åˆ°åˆé©ä½ç½®
      do {
        position = {
          row: randomInt(2, config.rows - 2),
          col: randomInt(2, config.columns - 2)
        };
        attempts++;
      } while (
        attempts < maxAttempts &&
        !isValidPlacement(position, occupiedPositions, config.minDistance)
      );

      if (attempts < maxAttempts) {
        // å»ºç«‹åœ°é»
        const place = createPlace(type as PlaceType, position);
        places[position.row][position.col] = place;
        grid[position.row][position.col] = MapPositionType.PLACE;
        occupiedPositions.push(position);
      }
    }
  });

  return places;
}

/**
 * æª¢æŸ¥ä½ç½®æ˜¯å¦æœ‰æ•ˆï¼ˆä¸é‡ç–Šä¸”ç¬¦åˆæœ€å°é–“è·ï¼‰
 */
function isValidPlacement(
  position: Position,
  occupied: Position[],
  minDistance: number
): boolean {
  return occupied.every(pos => {
    const distance = Math.abs(pos.row - position.row) +
                    Math.abs(pos.col - position.col);
    return distance >= minDistance;
  });
}
```

#### æ­¥é©Ÿ 3: ç”Ÿæˆéšœç¤™ç‰©

```typescript
/**
 * éš¨æ©Ÿç”Ÿæˆéšœç¤™ç‰©
 */
function generateObstacles(
  grid: MapPositionType[][],
  config: MapGenerationConfig
): void {
  const totalCells = (config.rows - 2) * (config.columns - 2);
  const obstacleCount = Math.floor(totalCells * config.obstacleRatio);

  let placed = 0;
  while (placed < obstacleCount) {
    const row = randomInt(1, config.rows - 1);
    const col = randomInt(1, config.columns - 1);

    // åªåœ¨ OPEN æ ¼å­æ”¾ç½®éšœç¤™ç‰©
    if (grid[row][col] === MapPositionType.OPEN) {
      grid[row][col] = MapPositionType.RESTRICTED;
      placed++;
    }
  }
}
```

#### æ­¥é©Ÿ 4: è¨­å®šèµ·å§‹é»

```typescript
/**
 * åœ¨ç©ºæ› å€åŸŸè¨­å®šèµ·å§‹é»
 */
function setStartPosition(
  grid: MapPositionType[][],
  config: MapGenerationConfig
): Position {
  // å°‹æ‰¾ 3x3 å€åŸŸéƒ½æ˜¯ OPEN çš„ä½ç½®
  for (let r = 2; r < config.rows - 2; r++) {
    for (let c = 2; c < config.columns - 2; c++) {
      if (isAreaClear(grid, r, c, 3)) {
        grid[r][c] = MapPositionType.START;
        return { row: r, col: c };
      }
    }
  }

  // æ‰¾ä¸åˆ°å‰‡è¿”å›ä¸­å¿ƒé»
  const center = {
    row: Math.floor(config.rows / 2),
    col: Math.floor(config.columns / 2)
  };
  grid[center.row][center.col] = MapPositionType.START;
  return center;
}

/**
 * æª¢æŸ¥å€åŸŸæ˜¯å¦ç©ºæ› 
 */
function isAreaClear(
  grid: MapPositionType[][],
  row: number,
  col: number,
  size: number
): boolean {
  const half = Math.floor(size / 2);
  for (let r = row - half; r <= row + half; r++) {
    for (let c = col - half; c <= col + half; c++) {
      if (grid[r]?.[c] !== MapPositionType.OPEN) {
        return false;
      }
    }
  }
  return true;
}
```

#### æ­¥é©Ÿ 5: é©—è­‰é€£é€šæ€§

```typescript
/**
 * ä½¿ç”¨ BFS é©—è­‰æ‰€æœ‰åœ°é»å¯å¾èµ·å§‹é»åˆ°é”
 */
function validateConnectivity(
  grid: MapPositionType[][],
  places: (Place | null)[][],
  start: Position
): boolean {
  const visited = new Set<string>();
  const queue: Position[] = [start];
  const reachablePlaces = new Set<string>();

  // BFS éæ­·
  while (queue.length > 0) {
    const pos = queue.shift()!;
    const key = `${pos.row},${pos.col}`;

    if (visited.has(key)) continue;
    visited.add(key);

    // è¨˜éŒ„å¯é”åœ°é»
    if (places[pos.row][pos.col]) {
      reachablePlaces.add(key);
    }

    // æ¢ç´¢å››å€‹æ–¹å‘
    const directions = [
      { row: -1, col: 0 },
      { row: 1, col: 0 },
      { row: 0, col: -1 },
      { row: 0, col: 1 }
    ];

    for (const dir of directions) {
      const newPos = {
        row: pos.row + dir.row,
        col: pos.col + dir.col
      };

      if (
        grid[newPos.row]?.[newPos.col] &&
        grid[newPos.row][newPos.col] !== MapPositionType.BOUNDARY &&
        grid[newPos.row][newPos.col] !== MapPositionType.RESTRICTED
      ) {
        queue.push(newPos);
      }
    }
  }

  // è¨ˆç®—æ‰€æœ‰åœ°é»ç¸½æ•¸
  let totalPlaces = 0;
  for (const row of places) {
    for (const place of row) {
      if (place) totalPlaces++;
    }
  }

  // é©—è­‰æ˜¯å¦æ‰€æœ‰åœ°é»éƒ½å¯é”
  return reachablePlaces.size === totalPlaces;
}

/**
 * å¦‚æœé€£é€šæ€§é©—è­‰å¤±æ•—ï¼Œç§»é™¤éšœç¤™ç‰©ä»¥å»ºç«‹è·¯å¾‘
 */
function fixConnectivity(
  grid: MapPositionType[][],
  places: (Place | null)[][],
  start: Position
): void {
  // æ‰¾åˆ°æ‰€æœ‰æœªé€£é€šçš„åœ°é»
  // ä½¿ç”¨ A* ç‚ºæ¯å€‹åœ°é»å»ºç«‹è·¯å¾‘
  // ç§»é™¤è·¯å¾‘ä¸Šçš„éšœç¤™ç‰©
  // å¯¦ä½œç´°ç¯€çœç•¥...
}
```

#### æ­¥é©Ÿ 6: ç”Ÿæˆæ´»å‹•

```typescript
/**
 * ç‚ºæ¯å€‹åœ°é»ç”Ÿæˆéš¨æ©Ÿæ´»å‹•
 */
function generateEvents(
  places: (Place | null)[][],
  config: MapGenerationConfig
): void {
  const [minEvents, maxEvents] = config.eventPerPlace;

  for (const row of places) {
    for (const place of row) {
      if (!place) continue;

      const eventCount = randomInt(minEvents, maxEvents + 1);
      place.events = [];

      for (let i = 0; i < eventCount; i++) {
        const event = createRandomEvent(place.id);
        place.events.push(event);
      }
    }
  }
}

/**
 * å»ºç«‹éš¨æ©Ÿæ´»å‹•
 */
function createRandomEvent(placeId: string): Event {
  const types = [EventType.LECTURE, EventType.SEMINAR, EventType.EXAM];
  const type = types[randomInt(0, types.length)];

  const baseEvent = {
    id: generateId(),
    placeId,
    type,
    date: generateRandomDate(),
    startTime: generateRandomTime(),
    endTime: '', // è¨ˆç®—å¾Œè¨­å®š
    score: randomInt(5, 15),
    attended: false
  };

  switch (type) {
    case EventType.LECTURE:
      return {
        ...baseEvent,
        name: generateLectureName(),
        courseCode: generateCourseCode(),
        lecturer: generateLecturerName()
      } as Lecture;

    case EventType.SEMINAR:
      return {
        ...baseEvent,
        name: generateSeminarName(),
        speakers: generateSpeakers(),
        topic: generateTopic()
      } as Seminar;

    case EventType.EXAM:
      return {
        ...baseEvent,
        name: `${generateCourseCode()} Exam`,
        courseCode: generateCourseCode(),
        duration: randomInt(60, 180)
      } as Exam;
  }
}
```

### 4.3 å®Œæ•´ç”Ÿæˆæµç¨‹

```typescript
/**
 * ä¸»è¦åœ°åœ–ç”Ÿæˆå‡½æ•¸
 */
export function generateCampusMap(
  config: MapGenerationConfig
): CampusMap {
  // 1. åˆå§‹åŒ–ç¶²æ ¼
  const grid = initializeGrid(config.rows, config.columns);

  // 2. æ”¾ç½®åœ°é»
  const places = placePlaces(grid, config);

  // 3. ç”Ÿæˆéšœç¤™ç‰©
  generateObstacles(grid, config);

  // 4. è¨­å®šèµ·å§‹é»
  const startPosition = setStartPosition(grid, config);

  // 5. é©—è­‰é€£é€šæ€§
  let attempts = 0;
  while (!validateConnectivity(grid, places, startPosition) && attempts < 10) {
    fixConnectivity(grid, places, startPosition);
    attempts++;
  }

  // å¦‚æœ 10 æ¬¡å˜—è©¦å¾Œä»ç„¡æ³•é€£é€šï¼Œé‡æ–°ç”Ÿæˆ
  if (attempts >= 10) {
    return generateCampusMap(config);
  }

  // 6. ç”Ÿæˆæ´»å‹•
  generateEvents(places, config);

  // 7. å»ºç«‹åœ°åœ–ç‰©ä»¶
  return {
    name: `Campus ${Date.now()}`,
    rows: config.rows,
    columns: config.columns,
    grid,
    places,
    startPosition,
    generatedAt: Date.now(),
    seed: config.seed
  };
}
```

---

## 5. ç­‰è·è¦–è§’æ¸²æŸ“ç³»çµ±

### 5.1 åº§æ¨™è½‰æ›

#### ç¶²æ ¼åº§æ¨™ â†’ ç­‰è·åº§æ¨™

```typescript
/**
 * å°‡ç¶²æ ¼åº§æ¨™è½‰æ›ç‚ºç­‰è·è¦–è§’è¢å¹•åº§æ¨™
 *
 * ç­‰è·è¦–è§’å…¬å¼:
 * screenX = (gridCol - gridRow) * tileWidth / 2
 * screenY = (gridCol + gridRow) * tileHeight / 2
 */
export function gridToIsometric(
  gridPos: Position,
  tileWidth: number,
  tileHeight: number
): IsometricPosition {
  return {
    x: (gridPos.col - gridPos.row) * (tileWidth / 2),
    y: (gridPos.col + gridPos.row) * (tileHeight / 2)
  };
}
```

#### ç­‰è·åº§æ¨™ â†’ ç¶²æ ¼åº§æ¨™

```typescript
/**
 * å°‡ç­‰è·è¦–è§’è¢å¹•åº§æ¨™è½‰æ›å›ç¶²æ ¼åº§æ¨™
 *
 * åå‘å…¬å¼:
 * gridCol = (screenX / tileWidth + screenY / tileHeight)
 * gridRow = (screenY / tileHeight - screenX / tileWidth)
 */
export function isometricToGrid(
  isoPos: IsometricPosition,
  tileWidth: number,
  tileHeight: number
): Position {
  return {
    col: Math.floor((isoPos.x / tileWidth) + (isoPos.y / tileHeight)),
    row: Math.floor((isoPos.y / tileHeight) - (isoPos.x / tileWidth))
  };
}
```

### 5.2 æ¸²æŸ“å±¤æ¬¡

```typescript
/**
 * æ¸²æŸ“é †åºï¼ˆå¾å¾Œåˆ°å‰ï¼‰
 */
export enum RenderLayer {
  GROUND = 0,          // åœ°é¢å±¤ï¼ˆç£šå¡Šï¼‰
  DECORATION = 1,      // è£é£¾å±¤ï¼ˆæ¨¹æœ¨ã€è‰åœ°ï¼‰
  BUILDING = 2,        // å»ºç¯‰å±¤ï¼ˆåœ°é»ï¼‰
  CHARACTER = 3,       // è§’è‰²å±¤ï¼ˆç©å®¶ï¼‰
  EFFECT = 4,          // ç‰¹æ•ˆå±¤ï¼ˆå‹•ç•«ï¼‰
  UI = 5               // UI å±¤ï¼ˆå°è©±æ¡†ï¼‰
}

/**
 * å¯æ¸²æŸ“ç‰©ä»¶ä»‹é¢
 */
export interface Renderable {
  layer: RenderLayer;
  position: Position;
  zIndex: number;       // åŒå±¤å…§çš„æ·±åº¦ï¼ˆrow + col æ±ºå®šï¼‰
  sprite: string;
  visible: boolean;
  render(ctx: CanvasRenderingContext2D): void;
}
```

### 5.3 ç­‰è·è¦–è§’æ¸²æŸ“å™¨

```typescript
/**
 * ç­‰è·è¦–è§’æ¸²æŸ“å¼•æ“
 */
export class IsometricRenderer {
  private canvas: HTMLCanvasElement;
  private ctx: CanvasRenderingContext2D;
  private tileWidth: number = 64;   // ç£šå¡Šå¯¬åº¦
  private tileHeight: number = 32;  // ç£šå¡Šé«˜åº¦
  private offsetX: number = 0;      // è¦–è§’åç§» X
  private offsetY: number = 0;      // è¦–è§’åç§» Y

  constructor(canvas: HTMLCanvasElement) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d')!;
    this.centerCamera();
  }

  /**
   * æ¸²æŸ“æ•´å€‹å ´æ™¯
   */
  render(map: CampusMap, player: Player): void {
    // æ¸…ç©ºç•«å¸ƒ
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

    // æ”¶é›†æ‰€æœ‰å¯æ¸²æŸ“ç‰©ä»¶
    const renderables: Renderable[] = [];

    // åŠ å…¥åœ°åœ–ç£šå¡Š
    renderables.push(...this.collectTiles(map));

    // åŠ å…¥åœ°é»
    renderables.push(...this.collectPlaces(map));

    // åŠ å…¥ç©å®¶
    renderables.push(this.createPlayerRenderable(player));

    // æ’åºï¼ˆå…ˆæŒ‰å±¤æ¬¡ï¼Œå†æŒ‰ zIndexï¼‰
    renderables.sort((a, b) => {
      if (a.layer !== b.layer) return a.layer - b.layer;
      return a.zIndex - b.zIndex;
    });

    // æ¸²æŸ“æ‰€æœ‰ç‰©ä»¶
    for (const renderable of renderables) {
      if (renderable.visible) {
        this.ctx.save();
        this.ctx.translate(this.offsetX, this.offsetY);
        renderable.render(this.ctx);
        this.ctx.restore();
      }
    }
  }

  /**
   * æ”¶é›†åœ°åœ–ç£šå¡Š
   */
  private collectTiles(map: CampusMap): Renderable[] {
    const tiles: Renderable[] = [];

    for (let row = 0; row < map.rows; row++) {
      for (let col = 0; col < map.columns; col++) {
        const type = map.grid[row][col];
        const pos = { row, col };
        const isoPos = gridToIsometric(pos, this.tileWidth, this.tileHeight);

        tiles.push({
          layer: RenderLayer.GROUND,
          position: pos,
          zIndex: row + col,
          sprite: this.getTileSprite(type),
          visible: true,
          render: (ctx) => {
            this.renderTile(ctx, isoPos, type);
          }
        });
      }
    }

    return tiles;
  }

  /**
   * æ¸²æŸ“å–®ä¸€ç£šå¡Š
   */
  private renderTile(
    ctx: CanvasRenderingContext2D,
    isoPos: IsometricPosition,
    type: MapPositionType
  ): void {
    ctx.save();
    ctx.translate(isoPos.x, isoPos.y);

    // ç¹ªè£½ç­‰è·è±å½¢ç£šå¡Š
    ctx.beginPath();
    ctx.moveTo(0, -this.tileHeight / 2);
    ctx.lineTo(this.tileWidth / 2, 0);
    ctx.lineTo(0, this.tileHeight / 2);
    ctx.lineTo(-this.tileWidth / 2, 0);
    ctx.closePath();

    // æ ¹æ“šé¡å‹å¡«å……é¡è‰²
    ctx.fillStyle = this.getTileColor(type);
    ctx.fill();

    // é‚Šæ¡†
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 1;
    ctx.stroke();

    ctx.restore();
  }

  /**
   * å–å¾—ç£šå¡Šé¡è‰²
   */
  private getTileColor(type: MapPositionType): string {
    switch (type) {
      case MapPositionType.BOUNDARY:
        return '#555';
      case MapPositionType.OPEN:
        return '#90EE90';
      case MapPositionType.RESTRICTED:
        return '#8B4513';
      case MapPositionType.PLACE:
        return '#87CEEB';
      case MapPositionType.START:
        return '#FFD700';
      default:
        return '#FFF';
    }
  }

  /**
   * å°‡ç›¸æ©Ÿç½®ä¸­æ–¼ç©å®¶
   */
  centerCamera(player?: Player): void {
    if (player) {
      const isoPos = gridToIsometric(
        player.currentPosition,
        this.tileWidth,
        this.tileHeight
      );
      this.offsetX = this.canvas.width / 2 - isoPos.x;
      this.offsetY = this.canvas.height / 2 - isoPos.y;
    } else {
      this.offsetX = this.canvas.width / 2;
      this.offsetY = this.canvas.height / 4;
    }
  }
}
```

---

## 6. éŠæˆ²æµç¨‹è¨­è¨ˆ

### 6.1 ä¸»è¦éŠæˆ²æµç¨‹

```mermaid
stateDiagram-v2
    [*] --> ä¸»é¸å–®
    ä¸»é¸å–® --> æ–°éŠæˆ²: é–‹å§‹æ–°éŠæˆ²
    ä¸»é¸å–® --> è¼‰å…¥éŠæˆ²: è¼‰å…¥å­˜æª”
    ä¸»é¸å–® --> è¨­å®š: èª¿æ•´è¨­å®š
    ä¸»é¸å–® --> [*]: é€€å‡º

    æ–°éŠæˆ² --> åœ°åœ–ç”Ÿæˆ
    åœ°åœ–ç”Ÿæˆ --> éŠç©ä¸­
    è¼‰å…¥éŠæˆ² --> éŠç©ä¸­

    éŠç©ä¸­ --> æš«åœ: ESCéµ
    éŠç©ä¸­ --> åœ°é»äº’å‹•: åˆ°é”åœ°é»
    éŠç©ä¸­ --> éŠæˆ²å®Œæˆ: æ‰€æœ‰ä»»å‹™å®Œæˆ

    åœ°é»äº’å‹• --> æ´»å‹•é¸æ“‡: æœ‰æ´»å‹•
    åœ°é»äº’å‹• --> éŠç©ä¸­: ç¹¼çºŒ
    æ´»å‹•é¸æ“‡ --> éŠç©ä¸­: å®Œæˆ

    æš«åœ --> éŠç©ä¸­: ç¹¼çºŒ
    æš«åœ --> ä¸»é¸å–®: è¿”å›ä¸»é¸å–®

    éŠæˆ²å®Œæˆ --> çµç®—ç•«é¢
    çµç®—ç•«é¢ --> ä¸»é¸å–®: è¿”å›ä¸»é¸å–®
```

### 6.2 ç©å®¶ç§»å‹•æµç¨‹

```typescript
/**
 * ç©å®¶ç§»å‹•è™•ç†
 */
function handlePlayerMove(
  player: Player,
  map: CampusMap,
  direction: Direction
): MoveResult {
  // è¨ˆç®—æ–°ä½ç½®
  const newPosition = calculateNewPosition(player.currentPosition, direction);

  // æª¢æŸ¥æ–°ä½ç½®é¡å‹
  const positionType = map.grid[newPosition.row]?.[newPosition.col];

  if (!positionType) {
    return { success: false, reason: 'Out of bounds' };
  }

  // è™•ç†ä¸åŒé¡å‹çš„ä½ç½®
  switch (positionType) {
    case MapPositionType.BOUNDARY:
    case MapPositionType.RESTRICTED:
      // ç¢°æ’
      player.totalHits++;
      playSound('collision');
      return {
        success: false,
        reason: 'Collision',
        message: 'ä½ æ’åˆ°äº†éšœç¤™ç‰©ï¼'
      };

    case MapPositionType.OPEN:
      // æœ‰æ•ˆç§»å‹•
      player.previousPosition = player.currentPosition;
      player.currentPosition = newPosition;
      player.totalMoves++;
      player.facing = direction;
      playSound('step');
      return { success: true };

    case MapPositionType.PLACE:
      // åˆ°é”åœ°é»
      player.previousPosition = player.currentPosition;
      player.currentPosition = newPosition;
      player.totalMoves++;
      player.facing = direction;
      playSound('arrive');

      // è§¸ç™¼åœ°é»äº’å‹•
      const place = map.places[newPosition.row][newPosition.col];
      if (place) {
        handlePlaceInteraction(player, place);
      }

      return { success: true, place };

    default:
      return { success: false, reason: 'Unknown tile type' };
  }
}

interface MoveResult {
  success: boolean;
  reason?: string;
  message?: string;
  place?: Place;
}
```

### 6.3 åœ°é»äº’å‹•æµç¨‹

```typescript
/**
 * åœ°é»äº’å‹•è™•ç†
 */
function handlePlaceInteraction(player: Player, place: Place): void {
  // ç°¡å–®åœ°é»ï¼ˆæ²’æœ‰æ´»å‹•ï¼‰
  if (place.events.length === 0 || place.events.every(e => e.attended)) {
    if (!place.visited) {
      // é¦–æ¬¡è¨ªå•
      player.totalScore += place.score;
      place.visited = true;

      // è¨˜éŒ„å¾—åˆ†
      const score: Score = {
        id: generateId(),
        sessionId: player.sessionId,
        mapName: 'ç•¶å‰åœ°åœ–',
        placeName: place.name,
        placeType: place.type,
        moves: player.totalMoves,
        hits: player.totalHits,
        score: place.score,
        timestamp: Date.now()
      };
      player.scoreHistory.push(score);

      // é¡¯ç¤ºè¨Šæ¯
      showDialog({
        type: 'place',
        title: place.name,
        content: `ä½ è¨ªå•äº†${place.name}ï¼Œç²å¾— ${place.score} åˆ†ï¼`
      });
    } else {
      // é‡è¤‡è¨ªå•
      showDialog({
        type: 'place',
        title: place.name,
        content: 'é€™è£¡æ²’æœ‰æ–°çš„äº‹æƒ…äº†ã€‚'
      });
    }
    return;
  }

  // æœ‰æ´»å‹•çš„åœ°é»
  const availableEvents = place.events.filter(e => !e.attended);

  showEventSelectionDialog(place, availableEvents, (selectedEvent) => {
    if (selectedEvent) {
      attendEvent(player, place, selectedEvent);
    }
  });
}

/**
 * åƒåŠ æ´»å‹•
 */
function attendEvent(player: Player, place: Place, event: Event): void {
  // è¨ˆç®—ç¸½å¾—åˆ†ï¼ˆåœ°é» + æ´»å‹•ï¼‰
  const totalScore = place.score + event.score;
  player.totalScore += totalScore;

  // æ¨™è¨˜ç‚ºå·²åƒåŠ 
  event.attended = true;

  // æ¨™è¨˜åœ°é»ç‚ºå·²è¨ªå•
  if (!place.visited) {
    place.visited = true;
  }

  // è¨˜éŒ„å¾—åˆ†
  const score: Score = {
    id: generateId(),
    sessionId: player.sessionId,
    mapName: 'ç•¶å‰åœ°åœ–',
    placeName: place.name,
    placeType: place.type,
    eventName: event.name,
    eventType: event.type,
    date: event.date,
    timeRange: `${event.startTime}-${event.endTime}`,
    moves: player.totalMoves,
    hits: player.totalHits,
    score: totalScore,
    timestamp: Date.now()
  };
  player.scoreHistory.push(score);

  // æª¢æŸ¥æˆå°±
  checkAchievements(player);

  // é¡¯ç¤ºè¨Šæ¯
  showDialog({
    type: 'event',
    title: event.name,
    content: `ä½ åƒåŠ äº†${getEventTypeName(event.type)}ã€Œ${event.name}ã€ï¼Œç²å¾— ${totalScore} åˆ†ï¼`
  });

  // æ’­æ”¾éŸ³æ•ˆ
  playSound('achievement');

  // è©¢å•æ˜¯å¦ç¹¼çºŒåƒåŠ å…¶ä»–æ´»å‹•
  const remainingEvents = place.events.filter(e => !e.attended);
  if (remainingEvents.length > 0) {
    showConfirmDialog(
      'é‚„æœ‰å…¶ä»–æ´»å‹•ï¼Œè¦ç¹¼çºŒåƒåŠ å—ï¼Ÿ',
      () => {
        showEventSelectionDialog(place, remainingEvents, (nextEvent) => {
          if (nextEvent) {
            attendEvent(player, place, nextEvent);
          }
        });
      },
      () => {
        // ä¸ç¹¼çºŒ
      }
    );
  }
}
```

### 6.4 éŠæˆ²å®Œæˆæª¢æŸ¥

```typescript
/**
 * æª¢æŸ¥éŠæˆ²æ˜¯å¦å®Œæˆ
 */
function checkGameCompletion(map: CampusMap, player: Player): boolean {
  // æª¢æŸ¥æ‰€æœ‰åœ°é»æ˜¯å¦å·²è¨ªå•
  for (const row of map.places) {
    for (const place of row) {
      if (place && !place.visited) {
        return false;
      }
    }
  }

  // æª¢æŸ¥æ‰€æœ‰æ´»å‹•æ˜¯å¦å·²åƒåŠ 
  for (const row of map.places) {
    for (const place of row) {
      if (place) {
        for (const event of place.events) {
          if (!event.attended) {
            return false;
          }
        }
      }
    }
  }

  return true;
}

/**
 * éŠæˆ²å®Œæˆè™•ç†
 */
function handleGameCompletion(player: Player, elapsedTime: number): void {
  // è¨ˆç®—æœ€çµ‚çµ±è¨ˆ
  const stats = {
    totalScore: player.totalScore,
    totalMoves: player.totalMoves,
    totalHits: player.totalHits,
    elapsedTime,
    efficiency: calculateEfficiency(player, elapsedTime)
  };

  // å„²å­˜åˆ°æ’è¡Œæ¦œ
  saveToLeaderboard(stats);

  // æª¢æŸ¥ä¸¦è§£é–æˆå°±
  checkCompletionAchievements(player, stats);

  // é¡¯ç¤ºçµç®—ç•«é¢
  showEndGameScreen(stats);
}
```

---

## 7. UI/UX è¨­è¨ˆ

### 7.1 ä¸»é¸å–®è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â”‚     ğŸ“ CAMPUS NAVIGATOR ğŸ“             â”‚
â”‚                                        â”‚
â”‚         [é–‹å§‹æ–°éŠæˆ²]                    â”‚
â”‚         [è¼‰å…¥éŠæˆ²]                      â”‚
â”‚         [æ’è¡Œæ¦œ]                        â”‚
â”‚         [è¨­å®š]                          â”‚
â”‚         [é—œæ–¼]                          â”‚
â”‚         [é€€å‡º]                          â”‚
â”‚                                        â”‚
â”‚                                        â”‚
â”‚   ç‰ˆæœ¬ 2.0  Â©  2025                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 éŠæˆ²ç•«é¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ® Campus Navigator     ğŸ’° å¾—åˆ†: 125.5    â±ï¸ 05:32    ğŸ“Š    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚  ğŸ“ ç•¶å‰ä½ç½®          â”‚
â”‚                                     â”‚  John Medley Building â”‚
â”‚         ç­‰è·è¦–è§’éŠæˆ²ç•«é¢             â”‚                       â”‚
â”‚                                     â”‚  ğŸ¯ ä»»å‹™é€²åº¦          â”‚
â”‚      /\  /\  /\  /\  /\  /\        â”‚  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘ 80%      â”‚
â”‚     /  \/  \/  \/  \/  \/  \       â”‚                       â”‚
â”‚    â”‚ ğŸ› â”‚ ğŸŒ³ â”‚ ğŸ“š â”‚ ğŸƒ â”‚ ğŸ­ â”‚      â”‚  ğŸ“Š çµ±è¨ˆ              â”‚
â”‚     \  /\  /\  /\  /\  /\  /       â”‚  ç§»å‹•: 42             â”‚
â”‚      \/  \/  \/  \/  \/  \/        â”‚  ç¢°æ’: 3              â”‚
â”‚    â”‚ ğŸŒ³ â”‚ ğŸ‘¤ â”‚ ğŸ½ â”‚ ğŸŒ³ â”‚ ğŸ« â”‚      â”‚  åœ°é»: 5/8            â”‚
â”‚     \  /\  /\  /\  /\  /\  /       â”‚  æ´»å‹•: 12/15          â”‚
â”‚      \/  \/  \/  \/  \/  \/        â”‚                       â”‚
â”‚                                     â”‚  ğŸ† æˆå°±              â”‚
â”‚                                     â”‚  â—‹ åˆæ¬¡æ¢ç´¢           â”‚
â”‚                                     â”‚  â— å­¸éœ¸ä¹‹è·¯           â”‚
â”‚                                     â”‚  â—‹ é›¶ç¢°æ’æŒ‘æˆ°         â”‚
â”‚                                     â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ æç¤º: ä½¿ç”¨ WASD æˆ–æ–¹å‘éµç§»å‹• | æŒ‰ ESC æš«åœ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 å°è©±æ¡†è¨­è¨ˆ

#### åœ°é»è¨ªå•å°è©±æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“š åœ–æ›¸é¤¨                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  æ­¡è¿ä¾†åˆ°åœ–æ›¸é¤¨ï¼                    â”‚
â”‚  é€™è£¡æœ‰è±å¯Œçš„å­¸ç¿’è³‡æºã€‚              â”‚
â”‚                                     â”‚
â”‚  ä½ ç²å¾—äº† 8.5 åˆ†ï¼                  â”‚
â”‚                                     â”‚
â”‚         [ç¢ºå®š]                      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ´»å‹•é¸æ“‡å°è©±æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ« John Medley Building            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¸æ“‡è¦åƒåŠ çš„æ´»å‹•ï¼š                  â”‚
â”‚                                     â”‚
â”‚  1. ğŸ“š Data Structures              â”‚
â”‚     è¬›åº§ | 10:00-12:00 | 5.0åˆ†     â”‚
â”‚                                     â”‚
â”‚  2. ğŸ’¬ AI & Machine Learning        â”‚
â”‚     ç ”è¨æœƒ | 14:00-16:00 | 8.0åˆ†   â”‚
â”‚                                     â”‚
â”‚  3. ğŸ“ Final Exam                   â”‚
â”‚     è€ƒè©¦ | 09:00-11:00 | 12.0åˆ†    â”‚
â”‚                                     â”‚
â”‚     [é¸æ“‡] [å–æ¶ˆ]                   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 å°åœ°åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–  â–  â–  â–  â–  â–  â– â”‚  åœ–ä¾‹:
â”‚ â–  Â· Â· ğŸ› Â· Â· â– â”‚  â–  ç‰†å£
â”‚ â–  Â· ğŸŒ³ Â· Â· Â· â– â”‚  Â· ç©ºåœ°
â”‚ â–  ğŸ“š Â· ğŸ‘¤ Â· Â· â– â”‚  ğŸŒ³ éšœç¤™
â”‚ â–  Â· Â· Â· ğŸ½ Â· â– â”‚  ğŸ‘¤ ç©å®¶
â”‚ â–  Â· Â· Â· Â· ğŸ« â– â”‚  ğŸ› åœ°é»
â”‚ â–  â–  â–  â–  â–  â–  â– â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ç‹€æ…‹ç®¡ç†

### 8.1 Zustand Store æ¶æ§‹

```typescript
/**
 * éŠæˆ²ç‹€æ…‹ Store
 */
export const useGameStore = create<GameStore>((set, get) => ({
  // ç‹€æ…‹
  status: GameStatus.MENU,
  map: null,
  isPaused: false,
  elapsedTime: 0,
  showDialog: false,
  currentDialog: null,
  settings: {
    soundEnabled: true,
    musicEnabled: true,
    volume: 0.7,
    showMiniMap: true,
    showGrid: false
  },

  // Actions
  startNewGame: () => {
    const config: MapGenerationConfig = {
      rows: 18,
      columns: 18,
      placeCount: {
        [PlaceType.LIBRARY]: [2, 3],
        [PlaceType.CAFETERIA]: [2, 4],
        [PlaceType.SPORTS_CENTER]: [1, 2],
        [PlaceType.LECTURE_HALL]: [3, 5],
        [PlaceType.EVENT_HALL]: [1, 2]
      },
      obstacleRatio: 0.15,
      minDistance: 3,
      eventPerPlace: [1, 3]
    };

    const map = generateCampusMap(config);

    set({
      status: GameStatus.PLAYING,
      map,
      isPaused: false,
      elapsedTime: 0
    });

    // åˆå§‹åŒ–ç©å®¶
    get().playerStore.initializePlayer(map.startPosition);
  },

  pauseGame: () => set({ isPaused: true }),
  resumeGame: () => set({ isPaused: false }),

  updateElapsedTime: (delta: number) => {
    if (!get().isPaused) {
      set(state => ({ elapsedTime: state.elapsedTime + delta }));
    }
  },

  showDialog: (dialog: DialogData) => {
    set({ showDialog: true, currentDialog: dialog, isPaused: true });
  },

  closeDialog: () => {
    set({ showDialog: false, currentDialog: null, isPaused: false });
  },

  updateSettings: (settings: Partial<GameSettings>) => {
    set(state => ({
      settings: { ...state.settings, ...settings }
    }));
  }
}));

/**
 * ç©å®¶ç‹€æ…‹ Store
 */
export const usePlayerStore = create<PlayerStore>((set, get) => ({
  // ç‹€æ…‹
  player: null,

  // Actions
  initializePlayer: (startPosition: Position) => {
    const player: Player = {
      currentPosition: startPosition,
      previousPosition: null,
      facing: Direction.DOWN,
      totalMoves: 0,
      totalHits: 0,
      totalScore: 0,
      scoreHistory: [],
      achievements: [],
      inventory: [],
      sessionId: generateSessionId(),
      isMoving: false,
      sprite: 'player_default'
    };

    set({ player });
  },

  movePlayer: (direction: Direction) => {
    const player = get().player;
    const map = useGameStore.getState().map;

    if (!player || !map) return;

    const result = handlePlayerMove(player, map, direction);

    if (result.success) {
      set({ player: { ...player } });

      if (result.place) {
        // è§¸ç™¼åœ°é»äº’å‹•
        handlePlaceInteraction(player, result.place);
      }

      // æª¢æŸ¥éŠæˆ²å®Œæˆ
      if (checkGameCompletion(map, player)) {
        handleGameCompletion(player, useGameStore.getState().elapsedTime);
      }
    }
  },

  addScore: (score: Score) => {
    set(state => ({
      player: state.player ? {
        ...state.player,
        totalScore: state.player.totalScore + score.score,
        scoreHistory: [...state.player.scoreHistory, score]
      } : null
    }));
  },

  unlockAchievement: (achievementId: string) => {
    set(state => ({
      player: state.player ? {
        ...state.player,
        achievements: [...state.player.achievements, achievementId]
      } : null
    }));
  }
}));
```

---

## 9. æœ¬åœ°å„²å­˜è¨­è¨ˆ

### 9.1 LocalStorage çµæ§‹

```typescript
/**
 * LocalStorage éµå€¼
 */
export const STORAGE_KEYS = {
  GAME_SAVE: 'campus_navigator_save',
  HIGH_SCORES: 'campus_navigator_high_scores',
  SETTINGS: 'campus_navigator_settings',
  ACHIEVEMENTS: 'campus_navigator_achievements'
} as const;

/**
 * éŠæˆ²å­˜æª”è³‡æ–™
 */
export interface GameSave {
  version: string;                      // å­˜æª”ç‰ˆæœ¬
  savedAt: number;                      // å„²å­˜æ™‚é–“
  sessionId: string;                    // æœƒè©± ID
  map: CampusMap;                       // åœ°åœ–ç‹€æ…‹
  player: Player;                       // ç©å®¶ç‹€æ…‹
  elapsedTime: number;                  // ç¶“éæ™‚é–“
}

/**
 * æœ€é«˜åˆ†è¨˜éŒ„
 */
export interface HighScore {
  id: string;
  playerName: string;
  score: number;
  moves: number;
  hits: number;
  elapsedTime: number;
  efficiency: number;
  completedAt: number;
}
```

### 9.2 å„²å­˜èˆ‡è¼‰å…¥

```typescript
/**
 * å„²å­˜éŠæˆ²
 */
export function saveGame(): boolean {
  try {
    const gameState = useGameStore.getState();
    const playerState = usePlayerStore.getState();

    if (!gameState.map || !playerState.player) {
      return false;
    }

    const save: GameSave = {
      version: '2.0.0',
      savedAt: Date.now(),
      sessionId: playerState.player.sessionId,
      map: gameState.map,
      player: playerState.player,
      elapsedTime: gameState.elapsedTime
    };

    localStorage.setItem(
      STORAGE_KEYS.GAME_SAVE,
      JSON.stringify(save)
    );

    return true;
  } catch (error) {
    console.error('Failed to save game:', error);
    return false;
  }
}

/**
 * è¼‰å…¥éŠæˆ²
 */
export function loadGame(): GameSave | null {
  try {
    const data = localStorage.getItem(STORAGE_KEYS.GAME_SAVE);

    if (!data) return null;

    const save: GameSave = JSON.parse(data);

    // é©—è­‰å­˜æª”ç‰ˆæœ¬
    if (save.version !== '2.0.0') {
      console.warn('Incompatible save version');
      return null;
    }

    return save;
  } catch (error) {
    console.error('Failed to load game:', error);
    return null;
  }
}

/**
 * å„²å­˜æœ€é«˜åˆ†
 */
export function saveHighScore(score: HighScore): void {
  try {
    const scores = getHighScores();
    scores.push(score);

    // æ’åºä¸¦ä¿ç•™å‰ 10 å
    scores.sort((a, b) => b.score - a.score);
    const top10 = scores.slice(0, 10);

    localStorage.setItem(
      STORAGE_KEYS.HIGH_SCORES,
      JSON.stringify(top10)
    );
  } catch (error) {
    console.error('Failed to save high score:', error);
  }
}

/**
 * å–å¾—æœ€é«˜åˆ†æ’è¡Œæ¦œ
 */
export function getHighScores(): HighScore[] {
  try {
    const data = localStorage.getItem(STORAGE_KEYS.HIGH_SCORES);
    return data ? JSON.parse(data) : [];
  } catch (error) {
    console.error('Failed to get high scores:', error);
    return [];
  }
}
```

---

## 10. åºåˆ—åœ–

### 10.1 éŠæˆ²å•Ÿå‹•åºåˆ—åœ–

```mermaid
sequenceDiagram
    actor User as ä½¿ç”¨è€…
    participant App
    participant GameStore
    participant MapGen as MapGenerator
    participant PlayerStore
    participant Renderer

    User->>App: é»æ“Šã€Œé–‹å§‹æ–°éŠæˆ²ã€
    App->>GameStore: startNewGame()
    GameStore->>MapGen: generateCampusMap(config)

    MapGen->>MapGen: initializeGrid()
    MapGen->>MapGen: placePlaces()
    MapGen->>MapGen: generateObstacles()
    MapGen->>MapGen: setStartPosition()
    MapGen->>MapGen: validateConnectivity()
    MapGen->>MapGen: generateEvents()

    MapGen-->>GameStore: CampusMap
    GameStore->>GameStore: set map & status
    GameStore->>PlayerStore: initializePlayer(startPos)

    PlayerStore->>PlayerStore: create Player
    PlayerStore-->>GameStore: Player initialized

    GameStore->>Renderer: render(map, player)
    Renderer-->>User: é¡¯ç¤ºéŠæˆ²ç•«é¢
```

### 10.2 ç©å®¶ç§»å‹•åºåˆ—åœ–

```mermaid
sequenceDiagram
    actor User as ä½¿ç”¨è€…
    participant Input as KeyboardHandler
    participant PlayerStore
    participant GameLogic
    participant Map
    participant UI

    User->>Input: æŒ‰ä¸‹æ–¹å‘éµ
    Input->>PlayerStore: movePlayer(direction)
    PlayerStore->>GameLogic: handlePlayerMove(player, map, direction)

    GameLogic->>GameLogic: calculateNewPosition()
    GameLogic->>Map: getPositionType(newPos)
    Map-->>GameLogic: MapPositionType

    alt ç¢°æ’ (BOUNDARY/RESTRICTED)
        GameLogic->>PlayerStore: increment hits
        GameLogic->>UI: showMessage("ç¢°æ’ï¼")
        GameLogic-->>PlayerStore: { success: false }

    else æœ‰æ•ˆç§»å‹• (OPEN)
        GameLogic->>PlayerStore: update position & moves
        GameLogic-->>PlayerStore: { success: true }

    else åˆ°é”åœ°é» (PLACE)
        GameLogic->>PlayerStore: update position & moves
        GameLogic->>Map: getPlace(newPos)
        Map-->>GameLogic: Place
        GameLogic->>PlayerStore: handlePlaceInteraction(place)
        GameLogic-->>PlayerStore: { success: true, place }
    end

    PlayerStore->>UI: trigger re-render
    UI-->>User: æ›´æ–°ç•«é¢
```

---

## 11. é¡åˆ¥åœ–

```mermaid
classDiagram
    class CampusMap {
        +string name
        +number rows
        +number columns
        +MapPositionType[][] grid
        +(Place|null)[][] places
        +Position startPosition
        +number generatedAt
        +number seed?
    }

    class Place {
        <<interface>>
        +string id
        +string name
        +PlaceType type
        +Position position
        +number score
        +boolean visited
        +boolean restricted
        +boolean bookable
        +boolean booked
        +Event[] events
        +string description
        +string sprite
    }

    class Library {
        +PlaceType.LIBRARY type
        +number studyRooms
        +string openHours
    }

    class Cafeteria {
        +PlaceType.CAFETERIA type
        +MenuItem[] menu
    }

    class SportsCenter {
        +PlaceType.SPORTS_CENTER type
        +boolean bookable
        +string[] facilities
    }

    class LectureHall {
        +PlaceType.LECTURE_HALL type
        +number capacity
        +string building
    }

    class EventHall {
        +PlaceType.EVENT_HALL type
        +boolean bookable
        +boolean stage
    }

    class Event {
        <<interface>>
        +number id
        +string name
        +EventType type
        +string date
        +string startTime
        +string endTime
        +number score
        +boolean attended
        +string placeId
    }

    class Lecture {
        +EventType.LECTURE type
        +string courseCode
        +string lecturer
    }

    class Seminar {
        +EventType.SEMINAR type
        +string[] speakers
        +string topic
    }

    class Exam {
        +EventType.EXAM type
        +string courseCode
        +number duration
    }

    class Player {
        +Position currentPosition
        +Position previousPosition?
        +Direction facing
        +number totalMoves
        +number totalHits
        +number totalScore
        +Score[] scoreHistory
        +string[] achievements
        +string[] inventory
        +string sessionId
        +boolean isMoving
        +string sprite
    }

    class Score {
        +string id
        +string sessionId
        +string mapName
        +string placeName
        +PlaceType placeType
        +string eventName?
        +EventType eventType?
        +string date?
        +string timeRange?
        +number moves
        +number hits
        +number score
        +number timestamp
    }

    class GameState {
        +GameStatus status
        +CampusMap map
        +Player player
        +number elapsedTime
        +boolean isPaused
        +boolean showDialog
        +DialogData currentDialog?
        +GameSettings settings
    }

    CampusMap *-- Place : contains
    Place <|-- Library : implements
    Place <|-- Cafeteria : implements
    Place <|-- SportsCenter : implements
    Place <|-- LectureHall : implements
    Place <|-- EventHall : implements

    Place *-- Event : has
    Event <|-- Lecture : implements
    Event <|-- Seminar : implements
    Event <|-- Exam : implements

    Player o-- Score : records
    GameState *-- CampusMap : has
    GameState *-- Player : has
```

---

## 12. æµç¨‹åœ–

### 12.1 éŠæˆ²ä¸»å¾ªç’°

```mermaid
flowchart TD
    Start([éŠæˆ²å•Ÿå‹•]) --> Init[åˆå§‹åŒ–éŠæˆ²å¼•æ“]
    Init --> LoadAssets[è¼‰å…¥è³‡æº]
    LoadAssets --> MainMenu{é¡¯ç¤ºä¸»é¸å–®}

    MainMenu -->|æ–°éŠæˆ²| GenMap[ç”Ÿæˆéš¨æ©Ÿåœ°åœ–]
    MainMenu -->|è¼‰å…¥| LoadGame[è¼‰å…¥å­˜æª”]
    MainMenu -->|è¨­å®š| Settings[èª¿æ•´è¨­å®š]
    MainMenu -->|é€€å‡º| End([çµæŸ])

    GenMap --> InitPlayer[åˆå§‹åŒ–ç©å®¶]
    LoadGame --> InitPlayer
    InitPlayer --> GameLoop{éŠæˆ²å¾ªç’°}

    GameLoop -->|æ›´æ–°| Update[æ›´æ–°éŠæˆ²ç‹€æ…‹]
    Update --> HandleInput[è™•ç†è¼¸å…¥]
    HandleInput --> UpdatePhysics[æ›´æ–°ç‰©ç†/ç¢°æ’]
    UpdatePhysics --> CheckEvents[æª¢æŸ¥äº‹ä»¶]
    CheckEvents --> Render[æ¸²æŸ“ç•«é¢]
    Render --> CheckPause{æ˜¯å¦æš«åœ?}

    CheckPause -->|å¦| CheckComplete{éŠæˆ²å®Œæˆ?}
    CheckPause -->|æ˜¯| PauseMenu{æš«åœé¸å–®}

    PauseMenu -->|ç¹¼çºŒ| GameLoop
    PauseMenu -->|å­˜æª”| SaveGame[å„²å­˜éŠæˆ²]
    PauseMenu -->|ä¸»é¸å–®| MainMenu

    SaveGame --> GameLoop

    CheckComplete -->|å¦| GameLoop
    CheckComplete -->|æ˜¯| EndScreen[çµç®—ç•«é¢]
    EndScreen --> SaveScore[å„²å­˜åˆ†æ•¸]
    SaveScore --> MainMenu

    Settings --> MainMenu
```

---

## 13. ç‹€æ…‹åœ–

### 13.1 éŠæˆ²ç‹€æ…‹æ©Ÿ

```mermaid
stateDiagram-v2
    [*] --> MENU: å•Ÿå‹•æ‡‰ç”¨

    MENU --> PLAYING: é–‹å§‹æ–°éŠæˆ²/è¼‰å…¥éŠæˆ²
    PLAYING --> PAUSED: æŒ‰ ESC
    PAUSED --> PLAYING: ç¹¼çºŒ
    PAUSED --> MENU: è¿”å›ä¸»é¸å–®

    PLAYING --> COMPLETED: å®Œæˆæ‰€æœ‰ç›®æ¨™
    COMPLETED --> MENU: æŸ¥çœ‹çµç®—å¾Œè¿”å›

    MENU --> [*]: é€€å‡ºæ‡‰ç”¨
```

### 13.2 åœ°é»ç‹€æ…‹æ©Ÿ

```mermaid
stateDiagram-v2
    [*] --> Unvisited: åœ°é»ç”Ÿæˆ
    Unvisited --> Visiting: ç©å®¶åˆ°é”

    Visiting --> NoEvents: æ²’æœ‰æ´»å‹•
    Visiting --> HasEvents: æœ‰æ´»å‹•

    NoEvents --> Visited: è¨ªå•å®Œæˆ

    HasEvents --> AttendingEvent: é¸æ“‡æ´»å‹•
    AttendingEvent --> HasMoreEvents: é‚„æœ‰æ´»å‹•
    AttendingEvent --> AllEventsAttended: æ‰€æœ‰æ´»å‹•å®Œæˆ

    HasMoreEvents --> HasEvents: ç¹¼çºŒ
    HasMoreEvents --> Visited: é›¢é–‹

    AllEventsAttended --> Visited: å®Œæˆ

    Visited --> [*]: å¯é‡è¤‡è¨ªå•
```

---

## 14. è™›æ“¬ç¢¼

### 14.1 éŠæˆ²ä¸»å¾ªç’°è™›æ“¬ç¢¼

```
FUNCTION gameLoop():
    lastTime = getCurrentTime()

    WHILE gameRunning:
        currentTime = getCurrentTime()
        deltaTime = currentTime - lastTime
        lastTime = currentTime

        // è™•ç†è¼¸å…¥
        processInput()

        // æ›´æ–°éŠæˆ²ç‹€æ…‹
        IF NOT isPaused:
            updateGameState(deltaTime)
            updatePlayer(deltaTime)
            updateAnimations(deltaTime)
            checkCollisions()
            checkGameCompletion()
        END IF

        // æ¸²æŸ“
        clearCanvas()
        renderMap()
        renderPlaces()
        renderPlayer()
        renderEffects()
        renderUI()
        renderDialog()

        // é™åˆ¶å¹€ç‡ï¼ˆ60 FPSï¼‰
        WAIT_FOR_NEXT_FRAME()
    END WHILE
END FUNCTION
```

### 14.2 ç¢°æ’åµæ¸¬è™›æ“¬ç¢¼

```
FUNCTION checkCollision(position: Position, map: CampusMap): CollisionResult
    // æª¢æŸ¥é‚Šç•Œ
    IF position.row < 0 OR position.row >= map.rows OR
       position.col < 0 OR position.col >= map.columns:
        RETURN { collided: true, type: 'boundary' }
    END IF

    // å–å¾—ä½ç½®é¡å‹
    tileType = map.grid[position.row][position.col]

    // æª¢æŸ¥ä¸åŒé¡å‹
    SWITCH tileType:
        CASE BOUNDARY:
            RETURN { collided: true, type: 'boundary' }

        CASE RESTRICTED:
            RETURN { collided: true, type: 'obstacle' }

        CASE OPEN:
            RETURN { collided: false }

        CASE PLACE:
            place = map.places[position.row][position.col]
            RETURN { collided: false, place: place }
    END SWITCH
END FUNCTION
```

### 14.3 A* å°‹è·¯æ¼”ç®—æ³•è™›æ“¬ç¢¼

```
FUNCTION findPath(start: Position, goal: Position, map: CampusMap): Position[]
    openSet = PriorityQueue()
    openSet.add(start, 0)

    cameFrom = Map()
    gScore = Map()
    gScore[start] = 0

    fScore = Map()
    fScore[start] = heuristic(start, goal)

    WHILE NOT openSet.isEmpty():
        current = openSet.poll()

        IF current == goal:
            RETURN reconstructPath(cameFrom, current)
        END IF

        FOR neighbor IN getNeighbors(current, map):
            tentative_gScore = gScore[current] + 1

            IF tentative_gScore < gScore.get(neighbor, INFINITY):
                cameFrom[neighbor] = current
                gScore[neighbor] = tentative_gScore
                fScore[neighbor] = tentative_gScore + heuristic(neighbor, goal)

                IF neighbor NOT IN openSet:
                    openSet.add(neighbor, fScore[neighbor])
                END IF
            END IF
        END FOR
    END WHILE

    RETURN [] // æ²’æœ‰è·¯å¾‘
END FUNCTION

FUNCTION heuristic(a: Position, b: Position): number
    // æ›¼å“ˆé “è·é›¢
    RETURN ABS(a.row - b.row) + ABS(a.col - b.col)
END FUNCTION
```

---

## 15. é–‹ç™¼è·¯ç·šåœ–

> ğŸ’¡ **è©³ç´°å·¥ä½œæ¸…å–®è«‹åƒè€ƒ**: [`todo.md`](./todo.md)
>
> æœ¬ç« ç¯€æä¾›é–‹ç™¼éšæ®µæ¦‚è¦½ï¼Œå®Œæ•´çš„ä»»å‹™æ¸…å–®ã€å„ªå…ˆç´šæ’åºã€æ¯æ—¥é€²åº¦è¿½è¹¤è«‹æŸ¥çœ‹ todo.md æª”æ¡ˆã€‚

### 15.1 éšæ®µä¸€ï¼šåŸºç¤æ¶æ§‹ï¼ˆWeek 1-2ï¼‰âœ… **å·²å®Œæˆ**

**ä¸»è¦ä»»å‹™**:
- å°ˆæ¡ˆè¨­å®šèˆ‡æŠ€è¡“é¸å‹
- å»ºç«‹é–‹ç™¼ç’°å¢ƒï¼ˆVite + React + TypeScriptï¼‰
- é…ç½®ç¨‹å¼ç¢¼è¦ç¯„å·¥å…·ï¼ˆESLint + Prettierï¼‰
- è¨­å®šç‹€æ…‹ç®¡ç†ï¼ˆZustandï¼‰
- å»ºç«‹ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰

**å®Œæˆæ—¥æœŸ**: 2025-10-18
**å®Œæˆåº¦**: 100%

---

### 15.2 éšæ®µäºŒï¼šæ ¸å¿ƒéŠæˆ²é‚è¼¯ï¼ˆWeek 3-4ï¼‰ğŸš§ **é€²è¡Œä¸­**

**å·²å®Œæˆé …ç›®**:
- âœ… éš¨æ©Ÿåœ°åœ–ç”Ÿæˆç³»çµ±ï¼ˆç¶²æ ¼ã€åœ°é»ã€éšœç¤™ç‰©ã€é€£é€šæ€§ã€æ´»å‹•ï¼‰
- âœ… åŸºç¤éŠæˆ²ç‹€æ…‹ç®¡ç†

**å¾…å®Œæˆé …ç›®** ğŸ¯ **é«˜å„ªå…ˆç´š**:
- ç©å®¶ç§»å‹•ç³»çµ±ï¼ˆéµç›¤æ§åˆ¶ã€ç¢°æ’åµæ¸¬ã€å‹•ç•«ï¼‰
- åœ°é»äº’å‹•ç³»çµ±ï¼ˆè¨ªå•é‚è¼¯ã€å°è©±æ¡†ã€æ´»å‹•åƒåŠ ã€å¾—åˆ†è¨ˆç®—ï¼‰

**å®Œæˆåº¦**: ç´„ 60%
**é è¨ˆå®Œæˆ**: è¿‘æœŸ

---

### 15.3 éšæ®µä¸‰ï¼šç­‰è·è¦–è§’æ¸²æŸ“ï¼ˆWeek 5-6ï¼‰ğŸ”¥ **æœ€é«˜å„ªå…ˆç´š**

**å·²å®Œæˆé …ç›®**:
- âœ… ç­‰è·åº§æ¨™è½‰æ›å·¥å…·

**å¾…å®Œæˆé …ç›®** ğŸ”¥ **æ€¥è¿«**:
- Canvas æ¸²æŸ“å™¨å»ºç«‹
- åœ°åœ–ç£šå¡Šæ¸²æŸ“ï¼ˆç­‰è·è±å½¢ï¼‰
- å»ºç¯‰ç‰©ç²¾éˆæ¸²æŸ“
- ç©å®¶ç²¾éˆæ¸²æŸ“ï¼ˆ8 æ–¹å‘ï¼‰
- åˆ†å±¤æ¸²æŸ“ç³»çµ±
- ç›¸æ©Ÿè·Ÿéš¨ç³»çµ±
- æ›¿æ›æ–‡å­—æ¨¡å¼

**å®Œæˆåº¦**: ç´„ 10%
**é è¨ˆå®Œæˆ**: æ€¥è¿«
**å‚™è¨»**: ç›®å‰ä½¿ç”¨æ–‡å­—æ¨¡å¼ç‚ºè‡¨æ™‚æ–¹æ¡ˆ

---

### 15.4 éšæ®µå››ï¼šUI/UX å®Œå–„ï¼ˆWeek 7-8ï¼‰âš ï¸ **ä¸­å„ªå…ˆç´š**

**ä¸»è¦ä»»å‹™**:
- å®Œæ•´ä¸»é¸å–®ç³»çµ±ï¼ˆè¼‰å…¥ã€æ’è¡Œæ¦œã€è¨­å®šç­‰ï¼‰
- HUD è¦–è¦ºå„ªåŒ–èˆ‡å‹•ç•«
- å°è©±æ¡†ç³»çµ±è¨­è¨ˆ
- çµ±è¨ˆé¢æ¿èˆ‡åœ–è¡¨
- å°åœ°åœ–åŠŸèƒ½
- æš«åœé¸å–®
- çµç®—ç•«é¢

**å®Œæˆåº¦**: ç´„ 20%ï¼ˆåŸºç¤ HUD å·²å¯¦ä½œï¼‰

---

### 15.5 éšæ®µäº”ï¼šè³‡æ–™æŒä¹…åŒ–ï¼ˆWeek 9ï¼‰âš ï¸ **ä¸­å„ªå…ˆç´š**

**ä¸»è¦ä»»å‹™**:
- LocalStorage å°è£å·¥å…·
- éŠæˆ²å­˜æª”/è¼‰å…¥ç³»çµ±
- æ’è¡Œæ¦œç³»çµ±
- è¨­å®šå„²å­˜
- è³‡æ–™é©—è­‰èˆ‡éŒ¯èª¤è™•ç†

**å®Œæˆåº¦**: 0%

---

### 15.6 éšæ®µå…­ï¼šéŸ³æ•ˆèˆ‡å‹•ç•«ï¼ˆWeek 10ï¼‰ğŸ’¡ **ä½å„ªå…ˆç´š**

**ä¸»è¦ä»»å‹™**:
- éŸ³æ•ˆç®¡ç†å™¨æ•´åˆ
- èƒŒæ™¯éŸ³æ¨‚èˆ‡éŸ³æ•ˆ
- ç²¾éˆå‹•ç•«ç³»çµ±
- ç‰¹æ•ˆç³»çµ±ï¼ˆç²’å­æ•ˆæœç­‰ï¼‰

**å®Œæˆåº¦**: 0%

---

### 15.7 éšæ®µä¸ƒï¼šæˆå°±ç³»çµ±ï¼ˆWeek 11ï¼‰ğŸ’¡ **ä½å„ªå…ˆç´š**

**ä¸»è¦ä»»å‹™**:
- æˆå°±æ¸…å–®å®šç¾©
- æˆå°±æª¢æŸ¥é‚è¼¯
- æˆå°±è§£é–å‹•ç•«
- æˆå°±é¢æ¿ UI

**å®Œæˆåº¦**: 0%

---

### 15.8 éšæ®µå…«ï¼šæ¸¬è©¦èˆ‡å„ªåŒ–ï¼ˆWeek 12ï¼‰âš ï¸ **ä¸­å„ªå…ˆç´š**

**ä¸»è¦ä»»å‹™**:
- å–®å…ƒæ¸¬è©¦æ’°å¯«
- æ•´åˆæ¸¬è©¦
- E2E æ¸¬è©¦ï¼ˆPlaywrightï¼‰
- æ•ˆèƒ½å„ªåŒ–
- Bug ä¿®å¾©

**å®Œæˆåº¦**: ç´„ 30%ï¼ˆå·²æœ‰æ¸¬è©¦åŠ‡æœ¬èˆ‡åˆæ­¥æ¸¬è©¦ï¼‰

---

### 15.9 éšæ®µä¹ï¼šéƒ¨ç½²èˆ‡æ–‡ä»¶ï¼ˆWeek 13ï¼‰ğŸ’¡ **ä½å„ªå…ˆç´š**

**ä¸»è¦ä»»å‹™**:
- GitHub Repository ç®¡ç†
- CI/CD è¨­å®š
- ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²ï¼ˆVercel/Netlifyï¼‰
- æ–‡ä»¶æ’°å¯«ï¼ˆREADMEã€ä½¿ç”¨æ‰‹å†Šç­‰ï¼‰

**å®Œæˆåº¦**: ç´„ 10%ï¼ˆGit å€‰åº«å·²å»ºç«‹ï¼‰

---

### ğŸ¯ ç•¶å‰é–‹ç™¼é‡é»

**ç«‹å³è‘—æ‰‹** ğŸ”¥:
1. **Canvas ç­‰è·è¦–è§’æ¸²æŸ“ç³»çµ±**
   - é€™æ˜¯æœ€é«˜å„ªå…ˆç´šï¼Œç›®å‰ä½¿ç”¨æ–‡å­—æ¨¡å¼åƒ…ç‚ºè‡¨æ™‚æ–¹æ¡ˆ
   - å®Œæˆå¾Œå°‡å¤§å¹…æå‡éŠæˆ²è¦–è¦ºé«”é©—

**è¿‘æœŸå®Œæˆ** ğŸ¯:
2. **ç©å®¶ç§»å‹•ç³»çµ±**
   - æ ¸å¿ƒéŠæˆ²äº’å‹•åŠŸèƒ½

3. **åœ°é»äº’å‹•ç³»çµ±**
   - å®Œæ•´éŠæˆ²å¾ªç’°çš„é—œéµ

**è©³ç´°ä»»å‹™æ¸…å–®**: è«‹åƒè€ƒ [`todo.md`](./todo.md) ç²å–å®Œæ•´çš„é–‹ç™¼ä»»å‹™ã€å„ªå…ˆç´šæ’åºå’Œæ¯æ—¥é€²åº¦è¿½è¹¤ã€‚

---

## 16. æ¸¬è©¦ç­–ç•¥

### 16.1 å–®å…ƒæ¸¬è©¦

```typescript
/**
 * åœ°åœ–ç”Ÿæˆå™¨æ¸¬è©¦
 */
describe('MapGenerator', () => {
  test('should generate valid map dimensions', () => {
    const config: MapGenerationConfig = {
      rows: 15,
      columns: 15,
      placeCount: { /* ... */ },
      obstacleRatio: 0.15,
      minDistance: 3,
      eventPerPlace: [1, 3]
    };

    const map = generateCampusMap(config);

    expect(map.rows).toBe(15);
    expect(map.columns).toBe(15);
    expect(map.grid).toHaveLength(15);
    expect(map.grid[0]).toHaveLength(15);
  });

  test('should ensure all places are reachable', () => {
    const map = generateCampusMap(defaultConfig);
    const reachable = validateConnectivity(
      map.grid,
      map.places,
      map.startPosition
    );

    expect(reachable).toBe(true);
  });
});

/**
 * ç¢°æ’ç³»çµ±æ¸¬è©¦
 */
describe('CollisionSystem', () => {
  test('should detect boundary collision', () => {
    const position = { row: 0, col: 5 };
    const result = checkCollision(position, mockMap);

    expect(result.collided).toBe(true);
    expect(result.type).toBe('boundary');
  });

  test('should detect obstacle collision', () => {
    const position = { row: 5, col: 5 };
    mockMap.grid[5][5] = MapPositionType.RESTRICTED;

    const result = checkCollision(position, mockMap);

    expect(result.collided).toBe(true);
    expect(result.type).toBe('obstacle');
  });
});
```

### 16.2 æ•´åˆæ¸¬è©¦

```typescript
/**
 * ç©å®¶ç§»å‹•æ•´åˆæ¸¬è©¦
 */
describe('Player Movement Integration', () => {
  test('should update player position on valid move', () => {
    const { result } = renderHook(() => usePlayerStore());

    act(() => {
      result.current.initializePlayer({ row: 5, col: 5 });
      result.current.movePlayer(Direction.UP);
    });

    expect(result.current.player?.currentPosition).toEqual({
      row: 4,
      col: 5
    });
    expect(result.current.player?.totalMoves).toBe(1);
  });

  test('should trigger place interaction on arrival', () => {
    const onPlaceVisit = jest.fn();
    const { result } = renderHook(() => usePlayerStore());

    // è¨­å®šåœ°é»
    mockMap.grid[4][5] = MapPositionType.PLACE;
    mockMap.places[4][5] = mockLibrary;

    act(() => {
      result.current.initializePlayer({ row: 5, col: 5 });
      result.current.movePlayer(Direction.UP);
    });

    expect(onPlaceVisit).toHaveBeenCalledWith(mockLibrary);
  });
});
```

### 16.3 E2E æ¸¬è©¦

```typescript
/**
 * Playwright E2E æ¸¬è©¦
 */
import { test, expect } from '@playwright/test';

test('complete game flow', async ({ page }) => {
  await page.goto('http://localhost:5173');

  // é–‹å§‹æ–°éŠæˆ²
  await page.click('text=é–‹å§‹æ–°éŠæˆ²');

  // ç­‰å¾…åœ°åœ–è¼‰å…¥
  await expect(page.locator('canvas')).toBeVisible();

  // ç§»å‹•ç©å®¶
  await page.keyboard.press('ArrowUp');
  await page.keyboard.press('ArrowRight');

  // æª¢æŸ¥åˆ†æ•¸æ›´æ–°
  const scoreText = await page.locator('[data-testid="score"]').textContent();
  expect(scoreText).toContain('å¾—åˆ†');

  // è¨ªå•åœ°é»
  // ... æ›´å¤šæ¸¬è©¦æ­¥é©Ÿ
});
```

---

## 17. ç¸½çµ

æœ¬è¦æ ¼æ–‡ä»¶å®šç¾©äº† **Campus Navigator Web Game** çš„å®Œæ•´æŠ€è¡“æ¶æ§‹å’Œå¯¦ä½œç´°ç¯€ï¼ŒåŒ…æ‹¬ï¼š

âœ… **å°ˆæ¡ˆæ¦‚è¿°**: æ¸…æ™°çš„éŠæˆ²ç›®æ¨™å’Œæ ¸å¿ƒç©æ³•
âœ… **æŠ€è¡“é¸å‹**: React + Vite + TypeScript + Zustand
âœ… **è³‡æ–™æ¨¡å‹**: å®Œæ•´çš„ TypeScript interfaces
âœ… **éš¨æ©Ÿåœ°åœ–ç”Ÿæˆ**: è©³ç´°çš„æ¼”ç®—æ³•è¨­è¨ˆ
âœ… **ç­‰è·è¦–è§’æ¸²æŸ“**: åº§æ¨™è½‰æ›å’Œæ¸²æŸ“ç³»çµ±
âœ… **éŠæˆ²æµç¨‹**: å®Œæ•´çš„äº’å‹•é‚è¼¯
âœ… **UI/UX è¨­è¨ˆ**: ç²¾ç¾çš„éŠæˆ²ä»‹é¢
âœ… **ç‹€æ…‹ç®¡ç†**: Zustand Store æ¶æ§‹
âœ… **æœ¬åœ°å„²å­˜**: LocalStorage è¨­è¨ˆ
âœ… **åœ–è¡¨æ–‡ä»¶**: åºåˆ—åœ–ã€é¡åˆ¥åœ–ã€æµç¨‹åœ–ã€ç‹€æ…‹åœ–
âœ… **è™›æ“¬ç¢¼**: é—œéµæ¼”ç®—æ³•å¯¦ä½œ
âœ… **é–‹ç™¼è·¯ç·šåœ–**: 13 é€±å®Œæ•´è¨ˆç•«
âœ… **æ¸¬è©¦ç­–ç•¥**: å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€E2E æ¸¬è©¦

### ç•¶å‰é€²åº¦ç¸½çµ (v2.1.0)

**å·²å®Œæˆ** (ç´„ 40%):
- âœ… éšæ®µä¸€ï¼šåŸºç¤æ¶æ§‹ (100%)
- âœ… éšæ®µäºŒï¼šæ ¸å¿ƒéŠæˆ²é‚è¼¯ - åœ°åœ–ç”Ÿæˆ (100%)
- âœ… Git ç‰ˆæœ¬æ§åˆ¶å»ºç«‹
- âœ… å®Œæ•´æ¸¬è©¦æ–‡ä»¶ï¼ˆåŠ‡æœ¬ + å ±å‘Šï¼‰

**é€²è¡Œä¸­** (ç´„ 20%):
- ğŸš§ éšæ®µäºŒï¼šç©å®¶ç§»å‹•èˆ‡äº’å‹•ç³»çµ± (0%)
- ğŸš§ éšæ®µä¸‰ï¼šCanvas æ¸²æŸ“ç³»çµ± (10%)

**å¾…é–‹ç™¼** (ç´„ 40%):
- â¸ï¸ éšæ®µå››è‡³ä¹ï¼šUI/UXã€æŒä¹…åŒ–ã€éŸ³æ•ˆç­‰

**ä¸‹ä¸€æ­¥è¡Œå‹•**:
1. ğŸ”¥ å¯¦ä½œ Canvas ç­‰è·è¦–è§’æ¸²æŸ“ï¼ˆæœ€é«˜å„ªå…ˆç´šï¼‰
2. ğŸ¯ å¯¦ä½œç©å®¶ç§»å‹•ç³»çµ±ï¼ˆé«˜å„ªå…ˆç´šï¼‰
3. ğŸ¯ å¯¦ä½œåœ°é»äº’å‹•ç³»çµ±ï¼ˆé«˜å„ªå…ˆç´šï¼‰

é–‹ç™¼åœ˜éšŠå¯ä¾æ“šæœ¬æ–‡ä»¶å’Œæ¸¬è©¦å ±å‘Šé€²è¡Œå¯¦ä½œï¼Œç¢ºä¿å°ˆæ¡ˆå“è³ªå’Œé€²åº¦ã€‚

**ç›¸é—œæ–‡ä»¶**:
- æ¸¬è©¦åŠ‡æœ¬: `script.md`
- æ¸¬è©¦å ±å‘Š: `test-report.md`
- é–‹ç™¼æ–‡ä»¶: `DEVELOPMENT.md`
- ä»»å‹™æ¸…å–®: `todo.md`

---

**æ–‡ä»¶ç‰ˆæœ¬**: 2.1.0
**æœ€å¾Œæ›´æ–°**: 2025-10-18
**Git Commit**: cca0227
**ç¶­è­·è€…**: Campus Navigator Development Team
